/**
 * version 1.3.13
 * desc topolr frontend base library
 * site http://topolr.org/
 * git git+https://github.com/topolr/topolr.git
 * author WangJinliang
 * hash 8ed970831c324e34739f9ea4960dbb8f
 */
!function(){"use strict";var t=function(t){return new c(t)},e=function(){var t={kenel:[{n:"webkit",g:/applewebkit\/([\d.]+)/},{n:"gecko",g:/gecko\/([\d.]+)/},{n:"trident",g:/trident\/([\d.]+)/},{n:"edge",g:/edge\/([\d.]+)/}],info:[{n:"chrome",g:/chrome\/([\d.]+)/},{n:"mozilla",g:/mozilla\/([\d.]+)/},{n:"firefox",g:/firefox\/([\d.]+)/},{n:"msie",g:/msie ([\d.]+)/},{n:"opera",g:/opera\/([\d.]+)/},{n:"safari",g:/safari\/([\d.]+)/},{n:"blackberry",g:/blackberry ([\d.]+)/},{n:"blackberry",g:/edge ([\d.]+)/}],os:[{n:"windows",g:/windows ([a-z\d. ]+)/},{n:"osx",g:/mac os x ([a-z\d. ]+)/},{n:"ios",g:/os ([a-z\d. _]+)/},{n:"linux",g:/linux ([a-z\d. _]+)/},{n:"linux",g:/linux/},{n:"blackberry",g:/blackberry ([a-z\d. ]+)/},{n:"blackberry",g:/bb[0-9]+/},{n:"windowsphone",g:/windows phone/}],mobile:[{n:"android",g:/android ([\d.]+)/},{n:"iphone",g:/iphone/},{n:"ipad",g:/ipad/},{n:"blackberry",g:/bb[0-9]+/},{n:"blackberry",g:/blackberry/},{n:"windowsphone",g:/iemobile/}]},e=window.navigator.userAgent.toLowerCase(),n={};for(var r in t){var i=!1;for(var o in t[r]){var s=t[r][o],a=e.match(s.g);if(a){var l=a[0].match(/[0-9._]+/);n[r]={name:s.n,version:l?l[0]:"unknow"},i=!0;break}}i||(n[r]={name:"unknow",version:"unknow"})}return n.kenel&&"trident"===n.kenel.name&&"7.0"===n.kenel.version&&(n.info={name:"msie",version:"11"}),n.name=function(){return n.info.name},n.version=function(){return n.info.verison},n.isMobile=function(){return"unknow"!==this.mobile.name},n.isAndroid=function(t){return 0===arguments.length?"android"===this.mobile.name:"android"===this.mobile.name&&parseInt(this.mobile.version)===parseInt(t)},n.isIos=function(t){return 0===arguments.length?"iphone"===this.mobile.name||"ipad"===this.mobile.name:("iphone"===this.mobile.name||"ipad"===this.mobile.name)&&parseInt(this.mobile.version)===parseInt(t)},n.isWebkit=function(t){return 0===arguments.length?"webkit"===this.kenel.name:"webkit"===this.kenel.name&&parseInt(this.kenel.version)===parseInt(t)},n.isGecko=function(t){return 0===arguments.length?"gecko"===this.kenel.name:"gecko"===this.kenel.name&&parseInt(this.kenel.version)===parseInt(t)},n.isTrident=function(){return"trident"===this.kenel.name},n.isEdge=function(){return"edge"===this.kenel.name},n.isIe=function(t){return 0===arguments.length?"msie"===this.info.name:"msie"===this.info.name&&parseInt(this.info.version)===parseInt(t)},n.isSupport=function(){return"webkit"===this.kenel.name||"gecko"===this.kenel.name||"trident"===this.kenel.name&&this.kenel.version/1>=6},n}(),n={isFunction:function(t){return"function"==typeof t&&t.constructor===window.Function},isEmptyObject:function(t){for(var e in t)return!1;return!0},isUndefined:function(t){return void 0===t},isWindow:function(t){return void 0!==t&&null!==t&&t===t.window},isDocument:function(t){return null!==t&&t.nodeType===t.DOCUMENT_NODE},isObject:function(t){return"object"==typeof t&&"[object object]"===Object.prototype.toString.call(t).toLowerCase()&&!t.length},isString:function(t){return"string"==typeof t&&t.constructor===String},isNumber:function(t){return"number"==typeof t},isNumeric:function(t){return!isNaN(parseFloat(t))&&isFinite(t)},isAvalid:function(t){return null!==t&&void 0!==t},isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},isQueryString:function(t){return n.isString(t)&&/(^|&).*=([^&]*)(&|$)/.test(t)},isElement:function(t){return t&&1===t.nodeType&&t.nodeName}},r={postData:function(t){if(t){if(t instanceof FormData||t instanceof Blob||t instanceof ArrayBuffer)return t;if(n.isObject(t)){var e=!1;for(var o in t)if(t[o]instanceof Blob||t[o]instanceof ArrayBuffer||t[o]instanceof File){e=!0;break}if(e){var s=new FormData;for(var o in t)t[o]instanceof Blob?s.append(o,t[o]):t[o]instanceof File?s.append(o,t[o]):n.isArray(t[o])||n.isObject(t[o])?s.append(o,window.encodeURIComponent(i.stringify(t[o]))):t[o]instanceof FormData||s.append(o,window.encodeURIComponent(t[o].toString()));return s}return r.queryString(t)}return n.isArray(t)?window.encodeURIComponent(i.stringify({key:t})):t}return null},queryString:function(t){var e="";if(t){for(var r in t){var o=t[r];n.isString(o)?e+=r+"="+window.encodeURIComponent(o)+"&":n.isObject(o)||n.isArray(o)?e+=r+"="+window.encodeURIComponent(i.stringify(o))+"&":o instanceof FormData||o instanceof Blob||o instanceof File||o instanceof ArrayBuffer||(e+=r+"="+(void 0!==o&&null!==o?window.encodeURIComponent(o.toString()):"")+"&")}return e.length>0?e.substring(0,e.length-1):""}return""},getURLInfo:function(t){var e=t.indexOf("?"),n=t.indexOf("#"),r="",i="",o=null,s=null,a=t,l=null,u=null;-1!==e&&-1!==n?(a=t.substring(0,e),e>n?(i=t.substring(n+1,e),r=t.substring(e+1)):(r=t.substring(e+1,n),i=t.substring(n+1))):-1!==e?(r=t.substring(e+1),a=t.substring(0,e)):-1!==n&&(i=t.substring(n+1),a=t.substring(0,n));var h=t.match(/:[0-9]+/g),c=t.match(/[a-z]+:\/\//);l=h?h[h.length-1].substring(1):null,u=c?c[0].substring(0,c[0].length-3):null,u&&(a=a.substring(u.length+3)),l&&(a=a.substring(0,a.length-l.length-1));var p=a.substring(0,a.indexOf("/"));if(a=""===p?a:p,""!==r){o={};for(var d=r.split("&"),f=0;f<d.length;f++){var g=d[f].split("=");o[g[0]]=g[1]}}if(""!==i){s={};for(var d=i.split("&"),f=0,v=d.length;v>f;f++){var g=d[f].split("=");s[g[0]]=g[1]}}return{query:o,hash:s,host:a,port:l,protocol:u}},queryObject:function(t){return r.getURLInfo(t).query},hashObject:function(t){return r.getURLInfo(t).hash}},i={parse:function(t){return window.JSON.parse(t)},stringify:function(t){return window.JSON.stringify(t)},each:function(t,e){var r,i=0,o=t.length,s=void 0===o||n.isFunction(t);if(s){for(r in t)if(e.call(t[r],r,t[r])===!1)break}else for(;o>i&&e.call(t[i],i,t[i++])!==!1;);return t},clone:function(t){var e;if(n.isArray(t)){e=[];for(var r=0;r<t.length;r++)e[r]=i.clone(t[r]);return e}if(n.isObject(t)){e={};for(var r in t)e[r]=i.clone(t[r]);return e}return t},cover:function(){var t,e,r,o,s,a,l=arguments[0]||{},u=1,h=arguments.length,c=!1;for("boolean"==typeof l&&(c=l,l=arguments[1]||{},u=2),"object"==typeof l||n.isFunction(l)||(l={}),h===u&&(l=this,u-=1);h>u;){if(t=arguments[u],null!==t)for(e in t)r=l[e],o=t[e],l!==o&&(s=n.isArray(o),c&&o&&(n.isObject(o)||s)?(s?(s=!1,a=r&&n.isArray(r)?r:[]):a=r&&n.isObject(r)?r:{},l[e]=i.cover(c,a,o)):void 0!==o&&(l[e]=o));u++}return l}},o=function(){var t={};return e.isWebkit()?(t.prefix="-webkit-",t.transitionEnd="webkitTransitionEnd"):"gecko"===e.isGecko()?(t.prefix="-moz-",t.transitionEnd="transitionend"):(t.prefix="",t.transitionEnd="transitionend"),t.fix=function(t){var e=/^-all-/;if(n.isString(t))return t.replace(e,this.prefix);if(n.isArray(t)){for(var r=[],i=0;i<t.length;i++)r.push(t[i].replace(e,this.prefix));return r}if(n.isObject(t)){var o={};for(var i in t)o[i.replace(e,this.prefix)]=n.isString(t[i])?t[i].replace(e,this.prefix):t[i];return o}return t},t}(),s={uuid:function(){for(var t,e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),n=new Array(36),r=0,i=0;36>i;i++)8===i||13===i||18===i||23===i?n[i]="":14===i?n[i]="4":(2>=r&&(r=33554432+16777216*Math.random()|0),t=15&r,r>>=4,n[i]=e[19===i?3&t|8:t]);return n.join("")},randomid:function(t){return(0===arguments.length||2>=t)&&(t=7),Math.random().toString(36).slice(2,t+2)},getDatasetName:function(t){for(var e="",n=0;n<t.length;n++)e+=/^[A-Z]+$/.test(t.charAt(n))?"-"+t.charAt(n).toLowerCase():t.charAt(n);return"data-"+e},getDatasetReserve:function(t){return t.substring(4).replace(/-[a-zA-Z]{1}/g,function(t){return t[1].toUpperCase()})},escape:function(t){return(""+t).replace(/&/g,"&").replace(/</g,"<").replace(/>/g,">").replace(/"/g,'"').replace(/'/g,"'").replace(/\//g,"/")}};t.json=i,t.is=n,t.browser=e,t.prefix=o,t.util=s,t.serialize=r,t.extend=t.json.cover,t.nfn=function(){};var l=function(){this.list=[],this.length=null,this.current=null,this.state="init",this._start=null,this._progress=null,this._complete=null,this.result=null,this._scope=null};l.prototype.add=function(t,e,n){if("init"!==this.state)throw Error("[topolr]-this queue can not add task when it is not in state of init.");return this.list.push({fn:t,parameter:n,error:e||null}),this},l.prototype.delay=function(t){this.add(function(){var e=this;setTimeout(function(){e.next()},t)})},l.prototype.scope=function(t){return 0===arguments.length?this._scope:(this._scope=arguments[0],this)},l.prototype.next=function(t){return this._progress&&this._progress.call(this,{total:this.length,runed:this.length-this.list.length,data:t}),l._fire.call(this,t),this},l.prototype.left=function(){return this.list.length},l.prototype.total=function(){return this.length},l.prototype.run=function(t){null===this.length&&(this._start&&this._start.call(this),this.length=this.list.length),this.state="running",l._fire.call(this,t)},l.prototype.stop=function(){return"running"===this.state&&(this.state="stop"),this},l.prototype.reset=function(){return null===this.length,this.state="init",this.result=null,this._scope=null,this},l.prototype.clean=function(){return this.list.length=0,this.state="end",this.length=0,this.reuslt=null,this},l.prototype.isRunning=function(){return"running"===this.state},l.prototype.isEnd=function(){return"end"===this.state},l.prototype.isStop=function(){return"stop"===this.state},l.prototype.start=function(t){return t&&(this._start=t),this},l.prototype.progress=function(t){return t&&(this._progress=t),this},l.prototype.complete=function(t){return t&&(this._complete=t),"end"===this.state&&this._complete.call(this,this.result),this},l.prototype.end=function(t){return this.state="end",this.result=t,this._complete.call(this,this.result),this.reset(),this},l._fire=function(t){if(this.list.length>0){var e=this.list.shift(),n=this;this.current=e;try{e.fn&&e.fn.call(n,t,e.parameter)}catch(r){l.error.call(this,t,r),this.next(t)}}else"end"!==this.state&&(this.state="end",this.result=t,this._complete&&this._complete.call(this,t));return this},l.error=function(t,e){this.current&&this.current.error&&this.current.error.call(this,t,e,this.current.parameter)},t.queue=function(){return new l};var u=function(){this.state="waiting",this.__list__=[],this.result=null,this.current=null,this._complete=null,this._notify=null,this.waits=1,this._completeTimes=0,this._handleTimes=0};u.prototype.add=function(t,e,n){return this.__list__.push({fn:t,error:e,parameters:n}),"waiting"===this.state&&this.__list__.length===this.waits&&u._fire.call(this,this.result),this},u.prototype.size=function(){return this.__list__.length},u.prototype.wait=function(t){return(0===arguments.length||0===t)&&(t=1e7),this.waits=t,this},u.prototype.work=function(t){return"waiting"===this.state&&(this.waits=1,u.next.call(this,t)),this},u.prototype.delay=function(t){return this.add(function(e){var n=this;setTimeout(function(){n.next(e)},t)}),this},u.prototype.notify=function(t){return t&&(this._notify=t),this},u.prototype.complete=function(t){return t&&(this._complete=t),this},u.prototype.isRunning=function(){return"running"===this.state},u.prototype.isWaiting=function(){return"waiting"===this.state},u.prototype.isHandleAtOnce=function(){return"running"===this.state&&this.__list__.length>0},u.prototype.completeTimes=function(){return this._completeTimes},u.prototype.handleTimes=function(){return this._handleTimes},u.prototype.clean=function(){this.__list__.length=0,this.state="waiting";for(var t in this)this[t]=null},u.prototype.next=function(t){return u.next.call(this,t),this},u.prototype.error=function(t){return u.error.call(this,t)},u.next=function(t){return this._notify&&this._notify.call(this,t),u._fire.call(this,t),this},u.error=function(t){return this.current&&this.current.error&&this.current.error(this,t),this},u._fire=function(t){if(this.__list__.length>0){this.state="running",this._handleTimes=this._handleTimes+1;var e=this.__list__.shift(),n=this;this.current=e;try{e.fn&&e.fn.call(n,t,e.parameters)}catch(r){u.error.call(r),u.next.call(n,t)}}else"running"===this.state&&(this.result=t,this.state="waiting",this._completeTimes=this._completeTimes+1,this.current=null),this._complete&&this._complete.call(this,t);return this},t.dynamicQueue=function(){return new u};var h=function(t){this._state=0,this._scope={},this._queue=new l,this._complete=null,this._finally=null,this._always=null,this._error=null,this._notify=null,this._finalerror=null,this._isfinalerror=!1;var e=this;this._queue.complete(function(t){if(1===e._state)for(var n=e;n;)n._isfinalerror=!0,n=n._parent;e._isfinalerror?e._error&&e._error.call(e._scope,t):e._complete&&e._complete.call(e._scope,t),e._always&&e._always.call(e._scope,t,{state:e._state,error:e._isfinalerror}),e._finally&&e._finally.call(e._scope,t,e._state)}),this._queue.progress(function(t){e._notify&&e._notify.call(e._scope,t)}),t&&setTimeout(function(){try{t.call(e._scope,function(t){e._state=0,e._queue.run(t)},function(t){e._state=1,e._queue.run(t)})}catch(n){console.error(n.stack),e._state=1,e._queue.end()}},0)};h.prototype.scope=function(t){return 1===arguments.length?(this._scope=t,this):this._scope},h.prototype.then=function(t,e){return this._done(t),this._fail(e),this},h.prototype.wait=function(t){var e=this;return this._done(function(n){t?t&&t.call(e._scope,n,function(t){e.next(t)}):e.next(n)}),this},h.prototype._done=function(t){var e=this;return this._queue.add(function(t,n){if(0===e._state)if(n){var r=n.call(e._scope,t);r instanceof h?(r._parent=e,r._finally=function(t){e._queue.next(t)}):e._queue.next(r)}else e._queue.next(t);else e._queue.next(t)},function(t,n){e._state=1,e._queue.next(n)},t),this},h.prototype._fail=function(t){var e=this;return this._queue.add(function(t,n){if(1===e._state)if(n){var r=n.call(e._scope,t);r instanceof h?(r._parent=e,r._finally=function(t){e._queue.next(t)}):e._queue.next(r)}else e._queue.next(t);else e._queue.next(t)},function(t,n){e._state=1,e._queue.next(n)},t),this},h.prototype.done=function(t){return n.isFunction(t)&&(this._complete=t),this},h.prototype.fail=function(t){return n.isFunction(t)&&(this._error=t),this},h.prototype.always=function(t){return n.isFunction(t)&&(this._always=t),this},h.prototype.reject=function(t){return setTimeout(function(){this._state=1,this._queue.run(t)}.bind(this),0),this},h.prototype.resolve=function(t){return setTimeout(function(){this._state=0,this._queue.run(t)}.bind(this),0),this},h.prototype.notify=function(t){return n.isFunction(t)&&(this._notify=t),this},h.prototype.delay=function(t){return this._queue.delay(t),this},h.prototype.clean=function(){this.queue.clean();for(var t in this)this[t]=null},t.promise=function(t){return new h(t)},t.all=function(){var e=t.promise();if(arguments.length>0)for(var n=Array.prototype.slice.call(arguments),r=n.length,i=0;i<n.length;i++)n[i].complete(function(){this.isResolve&&(r-=1,0===r&&e.resolve())});return e},t.any=function(){var e=t.promise();if(arguments.length>0)for(var n=Array.prototype.slice.call(arguments),r=n.length,i=!1,o=0;o<n.length;o++)n[o].complete(function(){r-=1,this.isResolve&&(i=!0),0===r&&i&&e.resolve()});return e};var c=function(t){if(this.nodes=[],this.length=0,1===arguments.length&&n.isAvalid(t))if(n.isString(t))c.util.isHTML(t)?this.nodes=c.util.parseHTML(t):this.nodes=c.util.query(window.document,t),this.length=this.nodes.length;else if(t instanceof f)this.nodes=t.nodes,this.length=t.length;else{if(n.isWindow(t)||n.isDocument(t))return new g(t);1===t.nodeType?(this.nodes=[t],this.length=1):(this.nodes=[],this.length=0)}else 0===arguments.length&&(this.nodes=[],this.length=0)};c.regs={root:/^(?:body|html)$/i,_class:/^\.([\w-]+)$/,_id:/^#([\w-]*)$/,_tag:/^[\w-]+$/,_html:/^\s*<(\w+|!)[^>]*>/,_tagName:/<([\w:]+)/,_property:/-+(.)?/g},c.util={getDom:function(t){var e=new c;return 1===arguments.length?(e.nodes=t,e.length=t.length):(e.nodes=[],e.length=0),e},isClass:function(t){return c.regs._class.test(t)},isId:function(t){return c.regs._id.test(t)},isTag:function(t){return c.regs._tag.test(t)},isHTML:function(t){return c.regs._html.test(t)},query:function(t,e){var n=null;switch(!0){case this.isId(e):var r=document.getElementById(e.substring(1,e.length));n=r?[r]:[];break;case this.isClass(e):var i=t.getElementsByClassName(e.substring(1,e.length));n=Array.prototype.slice.call(i);break;case this.isTag(e):var i=t.getElementsByTagName(e);n=Array.prototype.slice.call(i);break;default:n=Array.prototype.slice.call(t.querySelectorAll(e))}return n},queryChild:function(t,e){var n=t.getAttribute("id")||"__bright__";t.setAttribute("id",n);var r=c.util.query(t,"#"+n+">"+e);return"__bright__"===n&&t.removeAttribute("id"),r},queryChildAll:function(t,e){var n=t.getAttribute("id")||"__bright__";t.setAttribute("id",n);var r=c.util.query(t,"#"+n+" "+e);return"__bright__"===n&&t.removeAttribute("id"),r},repairTags:{area:{l:1,s:"<map>",e:""},param:{l:1,s:"<object>",e:""},col:{l:2,s:"<table><tbody></tbody><colgroup>",e:"</table>"},legend:{l:1,s:"<fieldset>"},option:{l:1,s:"<select multiple='multiple'>",e:""},thead:{l:1,s:"<table>",e:"</table>"},tr:{l:2,s:"<table><tbody>",e:""},td:{l:3,s:"<table><tbody><tr>",e:""},_general:{s:"",e:"",l:0}},parseHTML:function(t){var e=t.match(c.regs._tagName),n=c.util.repairTags[e?e[1]:"_general"]||c.util.repairTags._general,r=document.createElement("DIV");r.innerHTML=n.s+t+n.e;for(var i=r,o=0;o<n.l;o++)i=i.firstChild;return Array.prototype.slice.call(i.childNodes)},parseFlagment:function(t){var e=c.util.parseHTML(t),n=window.document.createDocumentFragment();for(var r in e)n.appendChild(e[r]);return n},propertyName:function(t){return t.replace(c.regs._property,function(t,e,n){return 0===n?t.substring(1,2):e?e.toUpperCase():""})},cleanNode:function(t){if(t){if(t.datasets){for(var e in t.datasets){var n=t.datasets[e];n&&n.clean&&n.clean(),t.datasets[e]=null}t.datasets=null}v.util.unbindnode(t);var r=t.getElementsByClassName("incache");for(var i in r)if(r[i].nodeType){for(var o in r[i].datasets){var s=r[i].datasets[o];s&&s.clean&&s.clean(),r[i].datasets[o]=null}r[i].datasets=null,v.util.unbindnode(r[i])}}},supported:function(t){return 1===arguments.length?n.isString(t)||t instanceof c||n.isWindow(t)||n.isDocument(t)||1===t.nodeType:!1}};var p=function(t){this.dom=t,this.mapping={},p.init.call(this),this.dom.get(0).addEventListener(o.transitionEnd,p.fn,!1),this.dom.data("_transition_",this)};p.fn=function(e){var n=t(e.currentTarget).data("_transition_"),r=e.propertyName;n.mapping[r]?n.mapping[r].promise&&n.mapping[r].promise.resolve():n.mapping[o.prefix+r]?n.mapping[o.prefix+r].promise&&n.mapping[o.prefix+r].promise.resolve():n.mapping.all&&n.mapping.all.promise&&n.mapping.all.promise.resolve()},p.setCss=function(){var t="";for(var e in this.mapping)this.mapping[e]&&(t+=e+" "+this.mapping[e].time+"ms "+this.mapping[e].type+" "+this.mapping[e].delay+"ms,");t=t.length>0?t.substring(0,t.length-1):"none",this.dom.css(o.prefix+"transition",t)},p.init=function(){for(var t=this.dom.css("-all-transition-timing-function").split(","),e=this.dom.css("-all-transition-delay").split(","),n=this.dom.css("-all-transition-duration").split(","),r=this.dom.css("-all-transition-property").split(","),i=0;i<r.length;i++)"all"!==r[i]&&(this.mapping[r[i]]={property:r[i],time:1e3*parseFloat(n[i]),type:t[i],delay:1e3*parseFloat(e[i]),fn:null})},p.prototype.set=function(e,n){var r={time:200,type:"ease-out",delay:0},i=new h;i.scope(this.dom),t.extend(r,n);for(var s=o.fix(e.split(",")),a=0;a<s.length;a++){var l=s[a];if("all"===l){this.mapping={all:{property:l,time:r.time,type:r.type,delay:r.delay,promise:i}};break}this.mapping[l]={property:l,time:r.time,type:r.type,delay:r.delay,promise:i}}return p.setCss.call(this),i},p.prototype.all=function(e){var n={time:200,type:"ease-out",delay:0},r=new h;return r.scope(this.dom),t.extend(n,e),this.mapping={all:{property:"all",time:n.time,type:n.type,delay:n.delay,promise:r}},p.setCss.call(this),r},p.prototype.get=function(t){var e=this.mapping[o.fix(t)];return e?{type:e.type,time:e.time,delay:e.delay,property:t}:e},p.prototype.remove=function(t){for(var e=o.fix(t.split(",")),n=0;n<e.length;n++)this.mapping[e[n]]&&(this.mapping[e[n]]=null);return p.setCss.call(this),this},p.prototype.removeAll=function(){return this.mapping={},p.setCss.call(this),this},p.prototype.scope=function(){return this.dom},p.prototype.clean=function(){this.dom.get(0).removeEventListener(o.transitionEnd,p.fn,!1);for(var t in this)this[t]=null};var d=function(t){this.dom=t,this.attrs=[],this.setter=[],d.defaultValue.call(this),t.data("_transform_",this)};d.parse=function(){var t=this.dom.css(o.prefix+"transform"),e=t.match(/(-?[0-9\.]+)/g);if(e){e.length>6&&e.shift();for(var n=0;n<e.length;n++)e[n]=e[n]/1}else e=[1,0,0,1,0,0];return e},d.defaultValue=function(){var t={translate:[0,0],translate3d:[0,0,0],translateX:0,translateY:0,translateZ:0,rotate:0,rotateX:0,rotateY:0,rotateZ:0,rotate3d:[0,0,0,1],scale:[1,1],scaleX:1,scaleY:1,scaleZ:1,scale3d:[1,1,1],skew:[0,0],skewX:0,skewY:0},e=d.parse.call(this);if(e){if(1!==e[0]){var n=this.dom.get(0),r=n.style.webkitTransform||n.style.mozTransform||n.style.msTransform||n.style.transform;if(r||""===r){var i=document.styleSheets;n.matches=n.matches||n.webkitMatchesSelector||n.mozMatchesSelector||n.msMatchesSelector;for(var o=0;o<i.length;o++)for(var s=i[o].cssRules||i[o].rules,a=0;a<s.length;a++)n.matches(s[a].selectorText)&&(r=s[a].style.webkitTransform||s[a].style.mozTransform||s[a].style.msTransform||s[a].style.transform)}if(r&&""!==r){for(var l=[],u=[],h="",c="",p=!0,o=0;o<r.length;o++){var f=r[o];"("!==f&&")"!==f?p?h+=f:c+=f:"("===f?(l.push(h.trim()),h="",p=!1):")"===f&&(u.push(c.trim()),c="",p=!0)}for(var o=0;o<l.length;o++){var g="";if(-1!==u[o].indexOf(",")){for(var v=u[o].split(","),m=0;m<v.length;m++)v[m]=parseFloat(v[m]);g=v}else g=parseFloat(u[o]);t[l[o]]=g}}}6===e.length?(t.translate3d=[e[4],e[5],0],t.translateX=e[4],t.translateY=e[5]):(t.translate3d=[e[12],e[13],e[14]],t.translateX=e[12],t.translateY=e[13],t.translateZ=e[14])}this.values=t},d.watcher={translate:function(){return"translate3d("+(n.isNumber(this.values.translate3d[0])?this.values.translate3d[0]+"px":this.values.translate3d[0])+","+(n.isNumber(this.values.translate3d[1])?this.values.translate3d[1]+"px":this.values.translate3d[1])+","+(n.isNumber(this.values.translate3d[2])?this.values.translate3d[2]+"px":this.values.translate3d[2])+")"},rotate3d:function(){var t="0000"!==this.values.rotate3d.join("")?"rotate3d("+this.values.rotate3d[0]+","+this.values.rotate3d[1]+","+this.values.rotate3d[2]+","+this.values.rotate3d[3]+"deg)":"";return t+=0!==this.values.rotateX?" rotateX("+this.values.rotateX+"deg)":"",t+=0!==this.values.rotateY?" rotateY("+this.values.rotateY+"deg)":"",t+=0!==this.values.rotateZ?" rotateZ("+this.values.rotateZ+"deg)":""},scale3d:function(){var t="111"!==this.values.scale3d.join("")?"scale3d("+this.values.scale3d[0]+","+this.values.scale3d[1]+","+this.values.scale3d[2]+")":"";return t+=1!==this.values.scaleX?" scaleX("+this.values.scaleX+")":"",t+=1!==this.values.scaleY?" scaleY("+this.values.scaleY+")":"",t+=1!==this.values.scaleZ?" scaleZ("+this.values.scaleZ+")":""},scale:function(){return"11"!==this.values.scale.join("")?"scale("+this.values.scale[0]+","+this.values.scale[1]+")":""},skew:function(){return"00"!==this.values.skew.join("")?"skew("+this.values.skew[0]+"deg,"+this.values.skew[1]+"deg)":""},rotate:function(){return 0!==this.values.rotate?"rotate("+this.values.rotate+"deg)":""}},d.watch=function(t){-1===this.attrs.indexOf(t)&&d.watcher[t]&&(this.attrs.push(t),this.setter.push(d.watcher[t]))},d.watchName=function(t){return-1!==t.indexOf("translate")?"translate":-1!==t.indexOf("skew")?"skew":-1!==t.indexOf("rotate")?"rotate3d"===t?"rotate3d":"rotate":-1!==t.indexOf("scale")?"scale3d"===t?"scale3d":"rotate":""},d.set=function(){var t="";for(var e in this.setter)t+=this.setter[e].call(this)+" ";this.dom.css(o.prefix+"transform",t)},d.translate=function(t,e,n){if(2===arguments.length){var r=this.values.translate3d[t];return/^[-0-9\.]*$/.test(r)===!1&&d.defaultValue.call(this),this.values.translate3d[t]}return this.values.translate3d[t]=n,this.values.translate[t]=n,this.values[e]=n,d.set.call(this),this},d.sett=function(t,e,n){return 2===arguments.length?this.values[t]:((void 0===n||null===n)&&(n=e),this.values[t]=n,d.set.call(this),this)},d.prototype.matrix=function(){return d.parse.call(this)},d.prototype.sets=function(t){for(var e in t)void 0!==this.values[e]&&(this.values[e]=t[e],d.watch.call(this,d.watchName(e)));return d.set.call(this),this},d.prototype.scale=function(t,e){return d.watch.call(this,"scale"),0===arguments.length?this.values.scale:((void 0===t||null===t)&&(t=1),(void 0===e||null===e)&&(e=1),this.values.scale[0]=t,this.values.scale[1]=e,d.set.call(this),this)},d.prototype.rotate=function(t){return d.watch.call(this,"rotate"),0===arguments.length?this.values.rotate:((void 0===t||null===t)&&(t=0),this.values.rotate=t,d.set.call(this),this)},d.prototype.scale3d=function(t,e,n){return d.watch.call(this,"scale3d"),0===arguments.length?this.values.scale3d:((void 0===t||null===t)&&(t=1),(void 0===e||null===e)&&(e=1),(void 0===n||null===n)&&(n=1),this.values.scale3d[0]=t,this.values.scale3d[1]=e,this.values.scale3d[2]=n,d.set.call(this),this)},d.prototype.rotate3d=function(t,e,n,r){return d.watch.call(this,"rotate3d"),0===arguments.length?this.values.rotate3d:((void 0===t||null===t)&&(t=0),(void 0===e||null===e)&&(e=0),(void 0===n||null===n)&&(n=0),(void 0===r||null===r)&&(r=0),this.values.rotate3d[0]=t,this.values.rotate3d[1]=e,this.values.rotate3d[2]=n,this.values.rotate3d[3]=r,d.set.call(this),this)},d.prototype.skew=function(t,e){return d.watch.call(this,"skew"),0===arguments.length?this.values.skew:((void 0===t||null===t)&&(t=1),(void 0===e||null===e)&&(e=1),this.values.skew[0]=t,this.values.skew[1]=e,d.set.call(this),this)},d.prototype.x=function(t){return d.watch.call(this,"translate"),d.translate.apply(this,0===arguments.length?[0,"translateX"]:[0,"translateX",t])},d.prototype.y=function(t){return d.watch.call(this,"translate"),d.translate.apply(this,0===arguments.length?[1,"translateY"]:[1,"translateY",t])},d.prototype.z=function(t){return d.watch.call(this,"translate"),d.translate.apply(this,0===arguments.length?[2,"translateZ"]:[2,"translateZ",t])},d.prototype.scaleX=function(t){return d.watch.call(this,"scale"),d.sett.apply(this,0===arguments.length?["scaleX",1,t]:["scaleX",1,t])},d.prototype.scaleY=function(t){return d.watch.call(this,"scale"),d.sett.apply(this,0===arguments.length?["scaleY",1,t]:["scaleY",1,t])},d.prototype.scaleZ=function(t){return d.watch.call(this,"scale"),d.sett.apply(this,0===arguments.length?["scaleZ",1,t]:["scaleZ",1,t])},d.prototype.rotateX=function(t){return d.watch.call(this,"rotate"),d.sett.apply(this,0===arguments.length?["rotateX",0,t]:["rotateX",0,t])},d.prototype.rotateY=function(t){return d.watch.call(this,"rotate"),d.sett.apply(this,0===arguments.length?["rotateY",0,t]:["rotateY",0,t])},d.prototype.rotateZ=function(t){return d.watch.call(this,"rotate"),d.sett.apply(this,0===arguments.length?["rotateZ",0,t]:["rotateZ",0,t])},d.prototype.skewX=function(t){return d.watch.call(this,"skew"),d.sett.apply(this,0===arguments.length?["skewX",0,t]:["skewX",0,t])},d.prototype.skewY=function(t){return d.watch.call(this,"skew"),d.sett.apply(this,0===arguments.length?["skewY",0,t]:["skewY",0,t])},d.prototype.origin=function(t,e){if(0===arguments.length){var t=this.dom.css(o.prefix+"transform-origin").split(" ");return{x:t[0],y:t[1]}}return 2===arguments.length?(this.dom.css(o.prefix+"transform-origin",t+" "+e),this):void 0},d.prototype.style=function(t){return 0===arguments.length?this.dom.css(o.prefix+"transform-style"):(this.dom.css(o.prefix+"transform-style",t),this)},d.prototype.perspective=function(t){return 0===arguments.length?this.dom.css(o.prefix+"perspective"):(this.dom.css(o.prefix+"perspective",t),this)},d.prototype.perspectiveOrigin=function(){if(0===arguments.length){var t=this.dom.css(o.prefix+"perspective-origin").split(" ");return{x:t[0],y:t[1]}}return 2===arguments.length?this.dom.css(o.prefix+"perspective-origin",t+" "+b):void 0},d.prototype.backface=function(){return 0===arguments.length?this.dom.css(o.prefix+"backface-visibility"):(this.dom.css(o.prefix+"backface-visibility",a),this)},d.prototype.clean=function(){for(var t in this)this[t]=null},d.prototype.scope=function(){return this.dom};var f=function(){};f.prototype.get=function(t){return t/=1,n.isAvalid(t)&&t>=0&&t<this.nodes.length?this.nodes[t]:null},f.prototype.ready=function(t){var e=/complete|loaded|interactive/;return e.test(window.document.readyState)?t&&t():window.document.addEventListener("DOMContentLoaded",function(){t&&t()},!1),this},f.prototype.find=function(t){var e=[];return this.isEmpty()||n.isString(t)&&(e=c.util.query(this.nodes[0],t)),c.util.getDom(e)},f.prototype.children=function(t){var e=[];return this.isEmpty()||(e=n.isString(t)?c.util.queryChild(this.nodes[0],t):1===arguments.length&&t>=0?this.nodes[0].children[t]?[this.nodes[0].children[t]]:[]:Array.prototype.slice.call(this.nodes[0].children)),c.util.getDom(e)},f.prototype.siblings=function(t){var e=[];if(!this.isEmpty()){var r=[];r=n.isString(t)&&this.nodes[0].parentNode?c.util.queryChild(this.nodes[0].parentNode,t):this.nodes[0].parentNode?Array.prototype.slice.call(this.nodes[0].parentNode.children):[];for(var i=0;i<r.length;i++)r[i]!==this.nodes[0]&&e.push(r[i])}return c.util.getDom(e)},f.prototype.has=function(t){for(var e=[],n=0;n<this.nodes.length;n++){var r=c.util.queryChild(this.nodes[n],t);r.length>0&&e.push(this.nodes[n])}return c.util.getDom(e)},f.prototype.index=function(){var t=-1;if(!this.isEmpty())for(var e=this.nodes[0].parentNode,n=0;n<e.children.length;n++)if(e.children[n]===this.nodes[0]){t=n;break}return t},f.prototype.filter=function(t){var e=[];if(!this.isEmpty()){var n=c.util.query(window.document,t);if(n.length>0)for(var r=0;r<this.nodes.length;r++)-1!==n.indexOf(this.nodes[r])&&e.push(this.nodes[r])}return c.util.getDom(e)},f.prototype.first=function(){var t=[];return this.isEmpty()||t.push(this.get(0)),c.util.getDom(t)},f.prototype.last=function(){var t=[];return this.nodes.length>0&&t.push(this.get(this.length-1)),c.util.getDom(t)},f.prototype.parent=function(){var t=arguments[0],e=[];if(!this.isEmpty())if(n.isString(t))for(var r=c.util.query(window.document,t),i=this.nodes[0].parentNode;i&&!n.isDocument(i);)-1!==r.indexOf(i)&&e.push(i),i=i.parentNode;else if(n.isNumber(t)&&t>0){for(var i=this.nodes[0].parentNode,o=t-1;i&&!n.isDocument(i)&&o>0;)o--,i=i.parentNode;e.push(i)}else this.nodes[0].parentNode&&e.push(this.nodes[0].parentNode);return c.util.getDom(e)},f.prototype.parents=function(){var t=arguments[0],e=[];if(!this.isEmpty()){for(var r=this.nodes[0].parentNode;r&&!n.isDocument(r);)e.push(r),r=r.parentNode;if(n.isString(t)){var i=c.util.query(window.document,t);e=e.filter(function(t){return-1!==i.indexOf(t)?!0:void 0})}}return c.util.getDom(e)},f.prototype.next=function(){var t=[];if(!this.isEmpty()){var e=this.nodes[0].nextSibling;e&&t.push(e)}return c.util.getDom(t)},f.prototype.nexts=function(t){var e=[],r=this;if(!this.isEmpty()){for(var i=this.nodes[0].nextSibling;i;)1===i.nodeType&&e.push(i),i=i.nextSibling;if(n.isString(t)&&this.nodes[0].parentNode){var o=c.util.queryChild(this.nodes[0].parentNode,t);e=e.filter(function(t){return-1!==o.indexOf(t)&&t!==r.nodes[0]?!0:void 0})}}return c.util.getDom(e)},f.prototype.prev=function(){var t=[];if(!this.isEmpty()){var e=this.nodes[0].previousSibling;e&&t.push(e)}return c.util.getDom(t)},f.prototype.prevs=function(t){var e=[],r=this;if(!this.isEmpty()){for(var i=this.nodes[0].previousSibling;i;)1===i.nodeType&&e.push(i),i=i.previousSibling;if(n.isString(t)&&this.nodes[0].parentNode){var o=c.util.queryChild(this.nodes[0].parentNode,t);e=e.filter(function(t){return-1!==o.indexOf(t)&&t!==r.nodes[0]?!0:void 0})}}return c.util.getDom(e)},f.prototype.eq=function(t){var e=[];return t>=0&&t<this.nodes.length&&e.push(this.nodes[t]),c.util.getDom(e)},f.prototype.each=function(t){if(t)for(var e=0,n=this.nodes.length;n>e&&t.call(this.nodes[e],this.nodes[e],e,this.nodes)!==!1;e++);
return this},f.prototype.remove=function(){var t=arguments[0];if(t&&n.isNumber(t)&&t<this.nodes.length){var e=this.nodes[t];e&&(c.util.cleanNode(e),e.parentNode.removeChild(e))}else if(n.isString(t))for(var r=c.util.query(window.document,t),i=0;i<this.nodes.length;i++)r.indexOf(-1!==this.nodes[i])&&this.nodes[i].parentNode&&this.nodes[i].parentNode.removeChild(this.nodes[i]);else for(var i=0;i<this.nodes.length;i++){var e=this.nodes[i];e&&(c.util.cleanNode(e),e.parentNode&&e.parentNode.removeChild(e))}return this},f.prototype.empty=function(){for(var t=0;t<this.nodes.length;t++){for(var e=this.nodes[t].children,n=0;n<e.length;n++)e[n].nodeType&&c.util.cleanNode(e[n]);this.nodes[t].innerHTML=""}return this},f.prototype.clean=function(){for(var t=0;t<=this.nodes.length;t++)c.util.cleanNode(this.nodes[t]);this.nodes=null,this.length=0},f.prototype.clone=function(){var t=[];return this.isEmpty()||t.push(this.nodes[0].cloneNode(!0)),c.util.getDom(t)},f.prototype.wrap=function(t){for(var e=0;e<this.nodes.length;e++){var r=null;if(n.isString(t))r=c.util.parseHTML(t)[0]||null;else if(t instanceof f)r=c.nodes[0];else if(t.nodeType)r=t;else if(n.isFunction(t)){var i=t();n.isString(i)&&(r=c.util.parseHTML(t)[0]||null)}if(r){var o=this.nodes[e];o.parentNode&&(o.parentNode.replaceChild(r,o),r.appendChild(o))}}return this},f.prototype.append=function(){var t=arguments[0];if(!this.isEmpty())if(n.isString(t))for(var e=c.util.parseFlagment(t),r=0;r<this.nodes.length;r++)this.nodes[r].appendChild(e.cloneNode(!0));else if(t instanceof f)for(var r=0;r<this.nodes.length;r++)this.nodes[r].appendChild(t.nodes[0]);else if(t&&t.nodeType)for(var r=0;r<this.nodes.length;r++)this.nodes[r].appendChild(t);else if(n.isFunction(t))for(var r=0;r<this.nodes.length;r++){var i=t.call(this.nodes[r],r,this.nodes[r].innerHTML);c.util.isHTML(i)&&this.nodes[r].appendChild(c.util.parseFlagment(i))}return this},f.prototype.appendTo=function(t){if(!this.isEmpty())if(n.isString(t)){var e=c.util.query(window.document,t);e.length>0&&e[0].appendChild(this.nodes[0])}else t instanceof f?t.length>0&&t.nodes[0].appendChild(this.nodes[0]):t.appendChild(this.nodes[0]);return this},f.prototype.insertBefore=function(t){if(!this.isEmpty())if(n.isString(t)){var e=c.util.query(window.document,t)[0];e&&e.parentNode&&e.parentNode.insertBefore(this.nodes[0],e)}else t instanceof f?!t.isEmpty()&&t.parent().get(0).insertBefore(this.nodes[0],t.get(0)):t.parentNode&&t.parentNode.insertBefore(this.nodes[0],t);return this},f.prototype.insertAfter=function(t){if(!this.isEmpty()){var e=null;if(n.isString(t))var e=c.util.query(window.document,t)[0]||null;else t instanceof f?e=t.nodes[0]||null:t.nodeType&&(e=t);e&&(e.nextSibling?e.parentNode.insertBefore(this.nodes[0],e.nextSibling):e.parentNode.appendChild(this.nodes[0]))}return this},f.prototype.prepend=function(){var t=arguments[0];if(!this.isEmpty())if(n.isString(t))for(var e=c.util.parseFlagment(t),r=0;r<this.nodes.length;r++)0!==this.nodes[r].childNodes.length?this.nodes[r].insertBefore(e.cloneNode(!0),this.nodes[r].firstChild):this.nodes[r].appendChild(e.cloneNode(!0));else if(n.isFunction(t))for(var r=0;r<this.nodes.length;r++){var i=t.call(this.nodes[r],r,this.nodes[r].innerHTML);c.util.isHTML(i)&&(this.nodes[r].childNodes.length>0?this.nodes[r].insertBefore(c.util.parseFlagment(i),this.nodes[r].firstChild):this.nodes[r].appendChild(c.util.parseFlagment(i)))}return this},f.prototype.prependTo=function(t){if(!this.isEmpty())if(n.isString(t)){var e=c.util.query(window.document,t);e.length>0&&(e[0].childNodes.length>0?e[0].insertBefore(this.nodes[0],e[0].firstChild):e[0].appendChild(this.nodes[0]))}else t instanceof f?t.isEmpty()||(t.nodes[0].childNodes.length>0?t.nodes[0].insertBefore(this.nodes[0],t.nodes[0].firstChild):t.nodes[0].appendChild(this.nodes[0])):1===t.nodeType&&(t.children.length>0?t.insertBefore(this.nodes[0],t.firstChild):t.appendChild(this.nodes[0]));return this},f.prototype.before=function(t){if(!this.isEmpty()&&this.nodes[0].parentNode)if(n.isString(t)){var e=c.util.parseFlagment(t);this.nodes[0].parentNode&&this.nodes[0].parentNode.insertBefore(e,this.nodes[0])}else t instanceof c?this.nodes[0].parentNode&&this.nodes[0].parentNode.insertBefore(t.nodes[0],this.nodes[0]):t.nodeType&&this.nodes[0].parentNode&&this.nodes[0].parentNode.insertBefore(t,this.nodes[0]);return this},f.prototype.after=function(t){if(!this.isEmpty()){var e=null;n.isString(t)?e=c.util.parseFlagment(t):t instanceof f?e=t.get(0):t.nodeType&&(e=t),this.nodes[0].nextSibling?this.nodes[0].parentNode&&this.nodes[0].parentNode.insertBefore(e,this.nodes[0].nextSibling):this.nodes[0].parentNode&&this.nodes[0].parentNode.appendChild(e)}return this},f.prototype.replaceWith=function(t){if(!this.isEmpty()){var e=null;n.isString(t)?e=c.util.query(window.document,t)[0]:t instanceof f?e=t.nodes[0]:t.nodeType&&(e=t),e&&e.parentNode.replaceChild(this.nodes[0],e)}return this},f.prototype.equal=function(t){return this===t},f.prototype.same=function(e){var n=!0;if(e=t(e),this.length===e.length){for(var r=0;r<this.nodes.length;r++)if(-1===e.nodes.indexOf(this.nodes[r])){n=!1;break}}else n=!1;return n},f.prototype.css=function(t,e){var r=this;if(!this.isEmpty())if(1===arguments.length&&n.isObject(t)){t=o.fix(t);for(var i=0;i<this.nodes.length;i++){var s=this.nodes[i].style.cssText;";"===!s[s.length-1]&&(s+=";");for(var a in t)s+=a+":"+t[a]+";";this.nodes[i].style.cssText=s}}else if(1===arguments.length&&n.isString(t))t=o.fix(t),r=window.getComputedStyle(this.nodes[0],"").getPropertyValue(t);else if(2===arguments.length)for(var i=0;i<this.nodes.length;i++){var l=o.fix(t);this.nodes[i].style[c.util.propertyName(l)]=e}return r},f.prototype.attr=function(t,e){var r=this;if(!this.isEmpty())if(2===arguments.length){if(""!==t)for(var i=0;i<this.nodes.length;i++)this.nodes[i].setAttribute(t,e)}else if(1===arguments.length)if(n.isObject(t))for(var o=0;o<this.nodes.length;o++)for(var i in t)""!==i&&this.nodes[o].setAttribute(i,t[i]);else t&&(r=this.nodes[0].getAttribute(t));return r},f.prototype.removeAttr=function(t){for(var e=0;e<this.nodes.length;e++)this.nodes[e].removeAttribute(t);return this},f.prototype.data=function(e,r){var i=null;if(!this.isEmpty())if(1===arguments.length)this.nodes[0].datasets||(this.nodes[0].datasets={}),n.isString(e)?void 0!==this.nodes[0].datasets[e]&&null!==this.nodes[0].datasets[e]&&(i=this.nodes[0].datasets[e]):n.isObject(e)&&t.extend(this.nodes[0].datasets,e);else if(2===arguments.length){this.addClass("incache");for(var o=0;o<this.nodes.length;o++)this.nodes[o].datasets||(this.nodes[o].datasets={}),this.nodes[o].datasets[e]=r;i=this}return i},f.prototype.removeData=function(t){return this.isEmpty()||1===arguments.length&&this.data(t,null),this},f.prototype.dataset=function(t,e){var r=this;if(this.nodes.length>0)if(1===arguments.length){if(n.isString(t))r=this.nodes[0].dataset?this.nodes[0].dataset[t]:this.nodes[0].getAttribute(s.getDatasetName(t));else if(n.isObject(t))for(var i in t)this.nodes[0].dataset?this.nodes[0].dataset[i]=t[i]:this.nodes[0].setAttribute(s.getDatasetName(i),t[i])}else if(2===arguments.length)for(var i=0;i<this.nodes.length;i++)this.nodes[0].dataset?this.nodes[i].dataset[t]=e:this.nodes[0].setAttribute(s.getDatasetName(t),e);else if(0===arguments.length)if(this.nodes[0].dataset)r=this.nodes[0].dataset;else{var o=this.nodes[0].attrbutes;r={};for(var i=0;i<o.length;o++)0===o[i].nodeName.indexOf("data-")&&(r[s.getDatasetReserve(o[i].nodeName)]=o[i].nodeValue)}return r},f.prototype.create=function(t,e){return t?e?this.nodes=[window.document.createElementNS(e,t)]:this.nodes=[window.document.createElement(t)]:this.nodes=[window.document.createDocumentFragment()],this.length=this.nodes.length,this},f.prototype.element=function(t,e){return t?e?this.nodes=[window.document.createElementNS(e,t)]:this.nodes=[window.document.createElement(t)]:this.nodes=[window.document.createDocumentFragment()],this.length=this.nodes.length,this},f.prototype.width=function(t){return 1===arguments.length?(n.isNumber(t)&&(t+="px"),this.css("width",t),this):this.nodes[0].offsetWidth},f.prototype.height=function(t){return 1===arguments.length?(n.isNumber(t)&&(t+="px"),this.css("height",t),this):this.nodes[0].offsetHeight},f.prototype.offset=function(){if(this.isEmpty())return null;var t=this.nodes[0].getBoundingClientRect();return{left:t.left+window.pageXOffset,top:t.top+window.pageYOffset,width:t.width,height:t.height}},f.prototype.hide=function(){for(var t=0;t<this.nodes.length;t++){var e=window.getComputedStyle(this.nodes[t],"").getPropertyValue("display");"none"!==e&&(this.nodes[t].setAttribute("ds",e),this.nodes[t].style.display="none")}return this},f.prototype.show=function(){for(var t=0;t<this.nodes.length;t++){var e=window.getComputedStyle(this.nodes[t],"").getPropertyValue("display");if("none"===e){var n=this.nodes[t].getAttribute("ds");n?(this.nodes[t].removeAttribute("ds"),this.nodes[t].style.display=n):this.nodes[t].style.display="block"}}return this},f.prototype.visible=function(t){for(var e=0;e<this.nodes.length;e++)t?this.nodes[e].style.visibility="visible":this.nodes[e].style.visibility="hidden";return this},f.prototype.html=function(t){var e=this;if(!this.isEmpty())if(1===arguments.length)for(var n=0;n<this.nodes.length;n++)this.nodes[n].innerHTML=t;else e=this.nodes[0].innerHTML;return e},f.prototype.outer=function(){return this.isEmpty()?"":this.nodes[0].outerHTML},f.prototype.text=function(t){var e=this;if(!this.isEmpty())if(1===arguments.length)for(var n=0;n<this.nodes.length;n++)this.nodes[n].innerText=t;else e=this.nodes[0].innerText;return e},f.prototype.val=function(t){var e=this;if(!this.isEmpty())if(1===arguments.length)for(var n=0;n<this.nodes.length;n++)this.nodes[n].value=t;else e=this.nodes[0].value;return e},f.prototype.addClass=function(t){for(var e=0;e<this.nodes.length;e++)this.nodes[e].classList?this.nodes[e].classList.add(t):-1===this.nodes[e].className.indexOf(t)&&(this.nodes[e].className=this.nodes[e].className+" "+t);return this},f.prototype.removeClass=function(t){for(var e=0;e<this.nodes.length;e++)if(this.nodes[e].classList)this.nodes[e].classList.remove(t);else if(-1!==this.nodes[e].className.indexOf(t)){var n=new RegExp("(\\s|^)"+t+"(\\s|$)");this.nodes[e].className=this.nodes[e].className.replace(n," ")}return this},f.prototype.contains=function(e){if(!this.isEmpty()){var n=t(e);if(!n.isEmpty())return this.nodes[0].contains(n.nodes[0])}return!1},f.prototype.contain=function(t){return this.same(t)||this.contains(t)},f.prototype.hasClass=function(t){var e=!1;return this.isEmpty()||(e=this.nodes[0].classList?this.nodes[0].classList.contains(t):-1===this.nodes[0].className.indexOf(t)),e},f.prototype.toggleClass=function(t){if(!this.isEmpty())if(this.nodes[0].classList)this.nodes[0].classList.toggle(t);else if(-1!==this.nodes[0].className.indexOf(t))for(var e=new RegExp("(\\s|^)"+t+"(\\s|$)"),n=0;n<this.nodes.length;n++)this.nodes[n].className=this.nodes[n].className.replace(e," ");else for(var n=0;n<this.nodes.length;n++)this.nodes[n].className=this.nodes[n].className+" "+t;return this},f.prototype.scrollTop=function(t){var e=this;if(0===arguments.length)e=this.isEmpty()?null:void 0!==this.nodes[0].scrollTop?this.nodes[0].scrollTop:this.nodes[0].scrollY;else for(var n=0;n<this.nodes.length;n++)void 0!==this.nodes[n].scrollTop?this.nodes[n].scrollTop=t:this.nodes[n].scrollY=t;return e},f.prototype.scrollLeft=function(t){var e=this;if(0===arguments.length)e=this.isEmpty()?null:void 0!==this.nodes[0].scrollLeft?this.nodes[0].scrollLeft:this.nodes[0].scrollX;else for(var n=0;n<this.nodes.length;n++)void 0!==this.nodes[n].scrollLeft?this.nodes[n].scrollLeft=t:this.nodes[n].scrollX=t;return e},f.prototype.click=function(t){return 1===arguments.length?this.bind("click",t):this.trigger("click"),this},f.prototype.load=function(t){return 1===arguments.length?this.bind("load",t):this.trigger("load"),this},f.prototype.trigger=function(t,e){return v.util.trigger(this,t,e)},f.prototype.bind=function(t,e){if(n.isString(t))return v.util.bind(this,t,e);if(n.isArray(t)){for(var r=0;r<t.length;r++)v.util.bind(this,t[r],e);return this}},f.prototype.unbind=function(t,e){return v.util.unbind(this,t,e)},f.prototype.isEmpty=function(t){return 0===arguments.length?0===this.nodes.length:n.isFunction(t)?(t.call(this,0===this.nodes.length),this):this},f.prototype.isWrapper=function(){return this instanceof f},f.prototype.add=function(e){var n=t(e);return this.nodes=this.nodes.concat(n.nodes),this.length=this.nodes.length,this},f.prototype.prop=function(t,e){for(var r=0;r<this.nodes.length;r++){var i=this.nodes[r][t];void 0!==i&&(n.isFunction(e)?this.nodes[r][t]=e.call(this.nodes[r],r,i):this.nodes[r][t]=e)}return this},f.prototype.position=function(t,e){if(0===arguments.length){var t=this.offsetParent();return t.length>0&&!n.isDocument(t.get(0))?{left:this.css("left"),top:this.css("top")}:this.offset()}return t&&this.css("left",t),e&&this.css("top",e),this},f.prototype.offsetParent=function(){var t=[];if(!this.isEmpty())if(void 0===this.nodes[0].offsetParent){for(var e=this.nodes[0].parentNode;e&&!c.regs.root.test(e.nodeName)&&"static"===window.getComputedStyle(e,"").getPropertyValue("position");)e=e.parentNode;t.push(e)}else t.push(this.nodes[0].offsetParent);return c.util.getDom(t)},f.prototype.scrollingLeft=function(e,n,r){var i=t.promise().scope(this),o=this;return this.scrollLeft()!==e?new y({from:this.scrollLeft(),to:e,during:n,fn:r,onrunning:function(t){o.scrollLeft(t)},onend:function(){i.resolve()}}).start():i.resolve(),i},f.prototype.scrollingTop=function(e,n,r){var i=t.promise().scope(this),o=this;return this.scrollTop()!==e?new y({from:this.scrollTop(),to:e,during:n,fn:r,onrunning:function(t){o.scrollTop(t)},onend:function(){i.resolve()}}).start():i.resolve(),i},f.prototype.transition=function(){var t=this.data("_transition_");return t||(t=new p(this)),t},f.prototype.animate=function(e,n){var r=this,i=this.data("_animate_"),s={duration:350,delay:0,type:"ease-out"};t.extend(s,n),e=o.fix(e);var a="";for(var l in e)a+=l+" "+s.duration+"ms "+s.type+" "+s.delay+"ms,";if(a.length>0&&(a=a.substring(0,a.length-1)),i)i.then(function(){var n=t.promise().scope(r),i=function(t){r.get(0).removeEventListener(o.transitionEnd,i,!1),n.resolve(t)};return r.css(o.prefix+"transition",a).get(0).addEventListener(o.transitionEnd,i,!1),r.css(e),n},function(t){return console.error(t),t});else{var u=t.promise().scope(r),h=function(t){r.get(0).removeEventListener(o.transitionEnd,h,!1),u.resolve(t)};r.css(o.prefix+"transition",a).get(0).addEventListener(o.transitionEnd,h,!1),r.css(e),r.data("_animate_",u),i=u}return i},f.prototype.transform=function(){var t=this.data("_transform_");return t||(t=new d(this)),t},f.prototype.isRemoved=function(){return this.nodes[0]?!window.document.contains(this.nodes[0]):!1},f.prototype.mutationObserve=function(t,e){if(!this.isEmpty()&&!this.nodes[0].datasets["-mutation-"]){var n=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,r=new n(t);r.observe(this.nodes[0],e),this.nodes[0].datasets["-mutation-"]=r}return this},f.prototype.unMutationObserve=function(){return this.isEmpty()||this.nodes[0].datasets["-mutation-"]&&(this.nodes[0].datasets["-mutation-"].disconnect(),this.nodes[0].datasets["-mutation-"].takeRecord(),this.nodes[0].datasets["-mutation-"]=null),this},f.prototype.finder=function(){return this.isEmpty()?null:this.nodes[0].datasets&&this.nodes[0].datasets["-finder-"]?this.nodes[0].datasets["-finder-"]:null},f.prototype.group=function(){return this.isEmpty()?null:this.nodes[0].datasets&&this.nodes[0].datasets["-groupitem-"]?this.nodes[0].datasets["-groupitem-"].group||null:null},f.prototype.items=function(t){var e=new c;if(!this.isEmpty()&&this.nodes[0].datasets["-group-"]&&this.nodes[0].datasets["-group-"].items)if(1===arguments.length)this.nodes[0].datasets["-group-"].items[t]&&e.add(this.nodes[0].datasets["-group-"].items[t]);else for(var n in this.nodes[0].datasets["-group-"].items)e.add(this.nodes[0].datasets["-group-"].items[n]);return e},f.prototype.item=function(){return this.isEmpty()?null:this.nodes[0].datasets&&this.nodes[0].datasets["-groupitem-"]?this.nodes[0].datasets["-groupitem-"]||null:null},f.prototype.cache=function(){if(this.isEmpty())return null;for(var t=this.nodes[0],e=this.dataset("cache"),n=!1;t&&t!==window.document;){if(t.datasets&&t.datasets["--cache--"]&&void 0!==t.datasets["--cache--"][e]){n=!0;break}t=t.parentNode}return n?t.datasets["--cache--"][e]:null},f.prototype.getModule=function(){return this.data("--view--")},f.prototype.predefined=function(t){var e=Array.prototype.slice.call(arguments),n=f.prototype[e[0]];return n?(e.splice(0,1),n.call(this,e)):this},f.prototype.delegate=function(e,n,r){this.bind(e,function(e){for(var i=e.target,o=e.currentTarget,s=c.util.queryChildAll(t(this).get(0),n);i!==o&&i!==window.document;){if(-1!==s.indexOf(i)){if(e._ispropagation)break;if(e.stopPropagation=function(){this._ispropagation=!0,Object.getPrototypeOf(e).stopPropagation.call(this)},r&&r.call(i,e),e._ispropagation)break}i=i.parentNode}})},c.prototype=new f;var g=function(t){this.obj=t};g.prototype.width=function(){return window.innerWidth},g.prototype.height=function(){return window.innerHeight},g.prototype.bind=function(t,e){return n.isWindow(this.obj)?window.addEventListener(t,e,!1):(this.nodes=[this.obj],v.util.bind(this,t,e)),this},g.prototype.unbind=function(t,e){return n.isWindow(this.obj)?window.removeEventListener(t,e,!1):(this.nodes=[this.obj],v.util.bind(this,t,e)),this},g.prototype.scrollTop=function(t){var e=this;return 0===arguments.length?e=document.body.scrollTop||document.documentElement.scrollTop:(document.body.scrollTop=t,document.documentElement.scrollTop=t),e},g.prototype.scrollLeft=function(t){var e=this;return 0===arguments.length?e=document.body.scrollLeft||document.documentElement.scrollLeft:document.body.scrollLeft=t,e},g.prototype.scrollingLeft=function(e,n,r){var i=t.promise().scope(this),o=this;return this.scrollLeft()!==e?new y({from:this.scrollLeft(),to:e,during:n,fn:r,onrunning:function(t){o.scrollLeft(t)},onend:function(){i.resolve()}}).start():i.resolve(),i},g.prototype.scrollingTop=function(e,n,r){var i=t.promise().scope(this),o=this;return this.scrollTop()!==e?new y({from:this.scrollTop(),to:e,during:n,fn:r,onrunning:function(t){o.scrollTop(t)},onend:function(){i.resolve()}}).start():i.resolve(),i};var v=function(t){this.currentTarget=null,this.target=null,this.timeStamp=(new Date).getTime(),this.type="",this.cancelable=!1,this._stop=!1,this.data=t};v.prototype.stopPropagation=function(){this._stop=!0},v.prototype.preventDefault=function(){this.cancelable=!0},v.trigger=function(t){var e=t.currentTarget.events[t.type];for(var n in e)e[n].call(t.currentTarget,t)},v.util={types:{HTMLEvents:"load,unload,abort,error,select,change,submit,reset,focus,blur,resize,scroll",MouseEvent:"click,mousedown,mouseup,mouseover,mousemove,mouseout",UIEvent:"DOMFocusIn,DOMFocusOut,DOMActivate",MutationEvent:"DOMSubtreeModified,DOMNodeInserted,DOMNodeRemoved,DOMNodeRemovedFromDocument,DOMNodeInsertedIntoDocument,DOMAttrModified,DOMCharacterDataModified"},isEvent:function(t){var e={type:t,interfaceName:null};for(var n in v.util.types)if(-1!==v.util.types[n].indexOf(t)){e.interfaceName=n;break}return e},bind:function(t,e,n){for(var r=0;r<t.nodes.length;r++)t.nodes[r].events||(t.nodes[r].events={}),t.nodes[r].events[e]?t.nodes[r].events[e].push(n):(t.nodes[r].events[e]=[],t.nodes[r].events[e].push(n)),t.nodes[r].addEventListener(e,v.trigger,!1);return t},unbind:function(t,e,r){for(var i=0;i<t.nodes.length;i++){var o=t.nodes[i];if(o.events)if(e&&""!==e){var s=o.events[e];if(s)if(o.removeEventListener(e,v.trigger,!1),n.isFunction(r))for(var i in s)s[i]===r&&s.splice(i,1);else s.length=0}else{var a=o.events;for(var i in a)o.removeEventListener(i,v.trigger,!1),a[i].length=0}}return t},unbindAll:function(t){for(var e=t.nodes,n=0;n<e.length;n++){var r=e[n].events;for(var i in r)e[n].removeEventListener(i,v.trigger,!1),r[i].length=0}return t},unbindnode:function(t){var e=t.events;for(var n in e)t.removeEventListener(n,v.trigger,!1),e[n].length=0},trigger:function(t,e,n){var r=this.isEvent(e);if(r.interfaceName){var i=document.createEvent(r.interfaceName);switch(r.interfaceName){case"MouseEvent":i.initMouseEvent(e,!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null);break;case"HTMLEvents":i.initEvent(e,!0,!1,window);break;case"UIEvents":i.initUIEvents(e,!0,!1,window,null);break;case"MutationEvent ":i.initMutationEvent(e,!0,!1,window,null,null,null,null)}for(var o=0;o<t.nodes.length;o++)t.nodes[o].dispatchEvent(i)}else{var s=new v(n);s.type=e,s.target=t.nodes[0];for(var a=t.nodes[0];a;){if(s.currentTarget=a,a.events&&a.events[e]){var l=a.events[e];for(var o in l)l[o].call(a,s)}if(s._stop)break;a=a.parentNode}}return t}};var m={linner:function(t,e,n,r){return n*t/r+e},"ease-in-quad":function(t,e,n,r){return n*(t/=r)*t+e},"ease-out-quad":function(t,e,n,r){return-n*(t/=r)*(t-2)+e},"ease-in-out-quad":function(t,e,n,r){return(t/=r/2)<1?n/2*t*t+e:-n/2*(--t*(t-2)-1)+e},"ease-in-cubic":function(t,e,n,r){return n*(t/=r)*t*t+e},"ease-out-cubic":function(t,e,n,r){return n*((t=t/r-1)*t*t+1)+e},"ease-in-out-cubic":function(t,e,n,r){return(t/=r/2)<1?n/2*t*t*t+e:n/2*((t-=2)*t*t+2)+e},"ease-in-quart":function(t,e,n,r){return n*(t/=r)*t*t*t+e},"ease-out-quart":function(t,e,n,r){return-n*((t=t/r-1)*t*t*t-1)+e},"ease-in-out-quart":function(t,e,n,r){return(t/=r/2)<1?n/2*t*t*t*t+e:-n/2*((t-=2)*t*t*t-2)+e},"ease-in-quint":function(t,e,n,r){return n*(t/=r)*t*t*t*t+e},"ease-out-quint":function(t,e,n,r){return n*((t=t/r-1)*t*t*t*t+1)+e},"ease-in-out-quint":function(t,e,n,r){return(t/=r/2)<1?n/2*t*t*t*t*t+e:n/2*((t-=2)*t*t*t*t+2)+e},"ease-in-sine":function(t,e,n,r){return-n*Math.cos(t/r*(Math.PI/2))+n+e},"ease-out-sine":function(t,e,n,r){return n*Math.sin(t/r*(Math.PI/2))+e},"ease-in-out-sine":function(t,e,n,r){return-n/2*(Math.cos(Math.PI*t/r)-1)+e},"ease-in-expo":function(t,e,n,r){return 0===t?e:n*Math.pow(2,10*(t/r-1))+e},"ease-out-expo":function(t,e,n,r){return t===r?e+n:n*(-Math.pow(2,-10*t/r)+1)+e},"ease-in-out-expo":function(t,e,n,r){return 0===t?e:t===r?e+n:(t/=r/2)<1?n/2*Math.pow(2,10*(t-1))+e:n/2*(-Math.pow(2,-10*--t)+2)+e},"ease-in-circ":function(t,e,n,r){return-n*(Math.sqrt(1-(t/=r)*t)-1)+e},"ease-out-circ":function(t,e,n,r){return n*Math.sqrt(1-(t=t/r-1)*t)+e},"ease-in-out-circ":function(t,e,n,r){return(t/=r/2)<1?-n/2*(Math.sqrt(1-t*t)-1)+e:n/2*(Math.sqrt(1-(t-=2)*t)+1)+e},"ease-in-elastic":function(t,e,n,r,i,o){var s;return 0===t?e:1==(t/=r)?e+n:("undefined"==typeof o&&(o=.3*r),!i||i<Math.abs(n)?(s=o/4,i=n):s=o/(2*Math.PI)*Math.asin(n/i),-(i*Math.pow(2,10*(t-=1))*Math.sin((t*r-s)*(2*Math.PI)/o))+e)},"ease-out-elastic":function(t,e,n,r,i,o){var s;return 0===t?e:1===(t/=r)?e+n:("undefined"==typeof o&&(o=.3*r),!i||i<Math.abs(n)?(i=n,s=o/4):s=o/(2*Math.PI)*Math.asin(n/i),i*Math.pow(2,-10*t)*Math.sin((t*r-s)*(2*Math.PI)/o)+n+e)},"ease-in-out-elastic":function(t,e,n,r,i,o){var s;return 0===t?e:2===(t/=r/2)?e+n:("undefined"==typeof o&&(o=r*(.3*1.5)),!i||i<Math.abs(n)?(i=n,s=o/4):s=o/(2*Math.PI)*Math.asin(n/i),1>t?-.5*(i*Math.pow(2,10*(t-=1))*Math.sin((t*r-s)*(2*Math.PI)/o))+e:i*Math.pow(2,-10*(t-=1))*Math.sin((t*r-s)*(2*Math.PI)/o)*.5+n+e)},"ease-in-back":function(t,e,n,r,i){return"undefined"==typeof i&&(i=1.70158),n*(t/=r)*t*((i+1)*t-i)+e},"ease-out-back":function(t,e,n,r,i){return"undefined"==typeof i&&(i=1.70158),n*((t=t/r-1)*t*((i+1)*t+i)+1)+e},"ease-in-out-back":function(t,e,n,r,i){return"undefined"==typeof i&&(i=1.70158),(t/=r/2)<1?n/2*(t*t*(((i*=1.525)+1)*t-i))+e:n/2*((t-=2)*t*(((i*=1.525)+1)*t+i)+2)+e},"ease-in-bounce":function(t,e,n,r){return n-m["ease-out-bounce"](r-t,0,n,r)+e},"ease-out-bounce":function(t,e,n,r){return(t/=r)<1/2.75?n*(7.5625*t*t)+e:2/2.75>t?n*(7.5625*(t-=1.5/2.75)*t+.75)+e:2.5/2.75>t?n*(7.5625*(t-=2.25/2.75)*t+.9375)+e:n*(7.5625*(t-=2.625/2.75)*t+.984375)+e},"ease-in-out-bounce":function(t,e,n,r){return r/2>t?.5*m["ease-in-bounce"](2*t,0,n,r)+e:.5*m["ease-out-bounce"](2*t-r,0,n,r)+.5*n+e}},y=function(t){this.from=n.isAvalid(t.from)?t.from:0,this.to=n.isAvalid(t.to)?t.to:100,n.isString(t.fn)?this.fn=m[t.type]||m["ease-out-quart"]:n.isFunction(t.fn)?this.fn=t.fn:this.fn=m["ease-out-quart"],this.during=Math.round((t.during||1e3)/16.7),this.onrunning=t.onrunning,this.onend=t.onend,this.delay=n.isAvalid(t.delay)?t.delay:0,this.isstop=!0};y._run=function(){var t=0,e=this.during,n=this.to-this.from,r=this,i=function(){t++,r.onrunning&&r.onrunning.call(r,r.fn(t,r.from,n,e)),e>t&&!r.isstop?requestAnimationFrame(i):(r.onend&&r.onend.call(r),r.isstop=!0)};i()},y._runs=function(){for(var t=0,e=this.during,n=[],r=this,i=0;i<this.from.length;i++)n.push(this.to[i]||0-this.from[i]);var o=function(){t++;for(var i=[],s=0;s<r.from.length;s++)i.push(r.fn(t,r.from[s],n[s],e));r.onrunning&&r.onrunning.call(r,i),e>t&&!r.isstop?requestAnimationFrame(o):(r.onend&&r.onend.call(r),r.isstop=!0)};o()},y._runo=function(){var t=0,e=this.during,n={},r=this;for(var i in this.from)n[i]=this.to[i]||0-this.from[i];var o=function(){t++;var i={};for(var s in r.from)i[s]=r.fn(t,r.from[s],n[s],e);r.onrunning&&r.onrunning.call(r,i),e>t&&!r.isstop?requestAnimationFrame(o):(r.onend&&r.onend.call(r),r.isstop=!0)};o()},y.prototype.start=function(){var t=this;return this.isstop=!1,setTimeout(function(){n.isArray(t.from)?y._runs.call(t):n.isObject(t.from)?y._runo.call(t):n.isNumber(t.from)&&y._run.call(t)},this.delay),this},y.prototype.stop=function(){return this.isstop=!0,this},y.prototype.isRunning=function(){return this.isstop===!0},y.prototype.clean=function(){for(var t in this)this[t]=null},t.tween=function(t){return new y(t)};var _=function(e){this.mimeType=null,this.data=e.data||"",this.url=e.url||"",this.realURL=e.url||"",this.method=e.method||"post",this.realType=e.dataType||"text",this.download=e.download||!1,this.dataType=-1!==["arraybuffer","blob","document","text"].indexOf(e.dataType)?e.dataType:"text",this.async=e.async===!1?!1:!0,this.timeout=e.timeout||3e6,this.headers=e.headers||{},this.events=t.extend({readystatechange:null,loadstart:null,progress:null,abort:null,error:null,load:null,timeout:null,loadend:null},e.events);var n=this;this._eventproxy=function(t){var e=n.events[t.type];n.response=this,e&&e.call(n,t),"loadend"===t.type&&n.clean()},this._uploadproxy=function(t){var e=n.events[t.type];n.response=this,e&&e.call(n,t)},this.xhr=new XMLHttpRequest};_.prototype.clean=function(){for(var t in this.events)"progress"===t?this.download===!0?this.xhr.removeEventListener(t,this._uploadproxy,!1):this.xhr.upload.removeEventListener(t,this._uploadproxy,!1):this.xhr.removeEventListener(t,this._eventproxy,!1);for(var t in this)this[t]=null},_.prototype.abort=function(){return this.xhr.abort(),this},_.prototype.header=function(t,e){if(1===arguments.length)for(var n in t)this.headers[n]=t[n];else this.headers[t]=e;return this},_.prototype.bind=function(t,e){if(1===arguments.length)for(var n in t)this.events[n]=t[n];else this.events[t]=e;return this},_.prototype.unbind=function(t,e){var n=this.events[t];for(var r in n)n[r]===e&&(n[r]=null);return this},_.prototype.fire=function(){if(this.mimeType&&this.xhr.overrideMimeType(this.mimeType),"get"===this.method){var t=r.queryString(this.data);this.url+=-1!==this.url.indexOf("?")?""===t?"":"&"+t:""===t?"":"?"+t}else this.data=r.postData(this.data);this.xhr.open(this.method,this.url,this.async),this.async&&(this.xhr.responseType=this.dataType,this.xhr.timeout=this.timeout);for(var e in this.events)"progress"===e?this.download===!0?this.xhr.addEventListener(e,this._uploadproxy,!1):this.xhr.upload.addEventListener(e,this._uploadproxy,!1):this.xhr.addEventListener(e,this._eventproxy,!1);this.xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");for(var e in this.headers)this.xhr.setRequestHeader(e,this.headers[e]);return n.isQueryString(this.data)&&this.xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded"),this.xhr.send(this.data),this},t.ajax=function(e){var n=new h;return e?(e.events=t.extend({error:function(t){e.error&&e.error.call(this,t),n.reject(t)},load:function(t){var r=this.response.status;if(r>=200&&300>r||304===r||0===r){var o=this.response.response;if("json"===this.realType){var s=this.response.responseText;try{o=i.parse(s)}catch(t){throw Error("[topolr] ajax unvaliable json string,url is '"+e.url+"' "+t)}}e.success&&e.success.call(this,o),n.resolve(o)}else e.error&&e.error.call(this,t),n.reject(this.response)}},e.events),new _(e).fire(),n):n.resolve()},t.request=function(t){return new _(t)};var w={importsmapping:{js:[],css:[],hasJs:function(t){return-1!==this.js.indexOf(t)?!0:!1},hasCss:function(t){return-1!==this.css.indexOf(t)?!0:!1},addJs:function(t){return this.js.push(t),this},addCss:function(t){return this.css.push(t),this}},css:function(t,e,n){if(w.importsmapping.hasCss(t))e&&e();else{var r=document.createElement("link"),i=null;r.href=t,r.type="text/css",r.rel="stylesheet";var o=function(t){r.removeEventListener("error",o),r.removeEventListener("load",s),n&&n.call(t.target,t)},s=function(t){r.removeEventListener("error",o),r.removeEventListener("load",s),e&&(clearTimeout(i),e.call(t.target,t))};r.addEventListener("error",o,!1),r.addEventListener("load",s,!1),document.getElementsByTagName("head")[0].appendChild(r),w.importsmapping.addCss(t);var a=function(){try{r.sheet.cssRules&&r.sheet.cssRules.length>0&&(r.removeEventListener("error",o),r.removeEventListener("load",s),e&&e.call(r))}catch(t){i=setTimeout(a,100)}};a()}return this},js:function(t,e,n,r){if(w.importsmapping.hasJs(t))e&&e();else{var i=function(t){t.target.removeEventListener("load",i),t.target.removeEventListener("error",o),e&&e.call(t.target,t)},o=function(t){t.target.removeEventListener("load",i),t.target.removeEventListener("error",o),n&&n.call(t.target,t)},s=document.createElement("script");s.src=t,s.type="text/javascript";for(var a in r)s[a]=r[a];s.addEventListener("load",i,!1),s.addEventListener("error",o,!1),document.getElementsByTagName("head")[0].appendChild(s),w.importsmapping.addJs(t)}return this},image:function(t,e,n){var r=document.createElement("img"),i=function(t){t.target.removeEventListener("load",i),t.target.removeEventListener("error",o),e&&e.call(t.target,t)},o=function(t){t.target.removeEventListener("load",i),t.target.removeEventListener("error",o),n&&n.call(t.target,t)};return r.src=t,r.addEventListener("load",i,!1),r.addEventListener("error",o,!1),this},load:function(t,e,n,r){if(t){var i=new l;for(var o in t)for(var s in t[o])i.add(function(t,e){var n=this;w[e.type](e.path,function(t){n.next()},function(t){r&&r.call(n,e.type,e.path)})},null,{type:o,path:t[o][s]});i.complete(function(){e&&e()}).progress(function(t){n&&n({total:t.total,runed:t.runed,progress:Math.floor(t.runed/t.total*100)})}).run()}else e&&e()}};t.loader=function(){return w};var k={_ready:null,_done:!1,_browser:!0,option:{debug:!0,sitePath:"",basePath:"",title:"",keywords:"",description:"",boot:""}},x={boot:function(e){if(!k._done){var n=k.option.boot,r=t.promise();return t().ready(function(){k.option.debug&&k.option.map&&t("body").dataset("builterId",k.option.map.id),e||t("body").html(""),x.setInfo(),k.option.debug&&console.log("[topolr] version:0.10.4,debug:"+k.option.debug+",basePath:"+k.option.basePath);try{k._ready&&k._ready()}catch(i){console.error(i)}N.init(k.option).done(function(){var e=t("body");e.length>0?(t.is.isString(n)?(e.dataset("view","root").dataset("viewId","root").dataset("option",n),n={}):e.dataset("view","root").dataset("viewId","root").dataset("option",""),M.getViewInstance(e,n,function(t){N.root=t,t.privator("render",function(){k._done=!0,r.resolve()})})):(console.error("[topolr boot] can not find the root element."),r.reject())})}),r}},ready:function(t){return k._ready=t,this},snapshot:function(){return window.pageComplete&&window.pageComplete(),this},getRoot:function(){return this.source.root},
setSitePath:function(t){return k._done||t&&(k.option.sitePath=t,"/"!==k.option.sitePath[k.option.sitePath.length-1]&&(k.option.sitePath=k.option.sitePath+"/"),k.option.basePath=(k.option.sitePath||"")+k.option.basePath),this},setInfo:function(e){e&&t.extend(k.option,{title:e.title||"",keywords:e.keywords||"",description:e.description||""}),t("title").html(k.option.title);var n=!1,r=!1;return t("meta").each(function(){"keywords"===t(this).attr("name")&&(t(this).attr("content",k.option.keywords),n=!0),"description"===t(this).attr("name")&&(t(this).attr("content",k.option.description),n=!0)}),n||t("<meta name='keywords' content='"+k.option.keywords+"'>").appendTo("head"),r||t("<meta name='description' content='"+k.option.description+"'>").appendTo("head"),this},setTitle:function(e){return k.option.title=e,t("title").html(k.option.title),this},isBrowser:function(){return k._browser},isReady:function(){return k._done},getOption:function(){return t.extend(!0,{},k.option)}};t.app=function(e){return!k._done&&e&&(e.sitePath&&"/"!==e.sitePath[e.sitePath.length-1]&&(e.sitePath=e.sitePath+"/"),e.basePath=(e.sitePath||"")+e.basePath,t.extend(k.option,e)),x};var N={basePath:"",debug:!1,ready:!1,sourceType:{packet:"js-text-content-text-p",template:"html-text-template-text-t",html:"html-text-html-text-h",js:"js-code-code-js-j",css:"css-code-css-css-c",json:"json-text-content-json-s",image:"png-nothing-code-image-i",text:"html-text-content-text-n"},sourceTypeAlias:{},current:{map:{},getPacketPath:function(t,e){e||(e="packet");var n=N.sourceTypeAlias[e],r=!0,i=N.current.map.c,o="";for(var s in i){var a=i[s];if(a[n]&&-1!==a[n].indexOf(t)){for(var l=0,u=0;u<a[n].length;u++){var h=a[n][u],c=N.current.map.m[n]?N.current.map.m[n][h]:null,p=N.local[e]&&N.local[e][h]?N.local[e][h].hash:"";c!==p&&l++}l>2&&(o=N.basePath+s+".js");break}}return o||(r=!1,o=N.getPacketPath(t,e)),{compress:r,path:o+(N.debug?"?t="+(new Date).getTime():"")}},get:function(t,e){e||(e="packet");var n=N.sourceTypeAlias[e];return N.current.map.m&&N.current.map.m[n]?N.current.map.m[n][t]:null}},local:{},root:null,persister:null,init:function(e){N.current.map=e.map||{d:!1},N.debug=N.current.map.d,N.basePath=e.basePath;for(var n in N.sourceType)N.sourceTypeAlias[n]=N.sourceType[n].split("-").pop();if(!N.debug&&e.map){var r=N.persist.checkPersist();"database"===r?N.persister=N.persist.database:"storage"===r?N.persister=N.persist.storage:N.persister=N.persist.empty}else N.persister=N.persist.empty;return N.persister.getAll().then(function(e){N.ready=!0,N.appender.appendInit(),N.local=t.extend({},e,N.local)},function(t){return console.error(t),t})},get:function(t,e){e||(e="packet");var n=N.getProcessor(e),r=n.loader,i=n.trigger,o=n.parser,s=N.local[e]?N.local[e][t]:null;if(s){var a=N.current.get(t,e);if(!a||s.hash===a)return N.trigger[i](s.content,t)}var l=N.current.getPacketPath(t,e),u=l.path;return l.compress?(N.root&&N.root.dispatchEvent("sourceload",{type:"full",path:u}),N.loader.compress(u).then(function(n){N.root&&N.root.dispatchEvent("sourceloaded",{type:"full",path:u});for(var r in n)for(var o=r,s=n[r],a=0;a<s.length;a++){var l=s[a],h=N.getProcessor(o).parser,c=N.parser[h](N.getPacketPath(l.p,o),l.c);N.local[o]||(N.local[o]={}),N.local[o][l.p]={hash:l.h,content:c}}N.persister.saveAll(N.local);var p=N.local[e][t];if(p)return N.trigger[i](p.content,t);throw Error("[topolr] packet can not find name is "+t)},function(t){return console.error(t),t})):(N.root&&N.root.dispatchEvent("sourceload",{type:"slice",path:u}),N.loader[r](u).then(function(n){return N.root&&N.root.dispatchEvent("sourceloaded",{type:"slice",path:u}),n=N.parser[o](u,n),N.local[e]||(N.local[e]={}),N.local[e][t]={hash:N.current.get(t,e),content:n},N.persister.saveAll(N.local),N.trigger[i](n,t)},function(e){return console.error("[topolr] packet can not find name is "+t),e}))},getPacketName:function(t){return t.substring(N.basePath.length).split(".")[0].replace(/\//g,".")},getProcessor:function(t){var e="nothing",n="text",r="content";if(N.sourceType[t]){var i=N.sourceType[t].split("-");e=i[1],r=i[2],n=i[3]}return{loader:e,parser:r,trigger:n}},getPacketPath:function(t,e){var n=N.current.get(t,e),r="",i=t.split(/\[|\]/),t=i[0],o=i[1];if(o||(o=N.sourceType[e]?N.sourceType[e].split("-")[0]:"html"),null!==n&&void 0!==n)if(N.debug)r=N.basePath+t.replace(/\./g,"/")+"."+o+"?h="+n;else{var s=t.split(".");s.pop(),r=N.basePath+s.join("/")+"/"+n+"."+o}else r=N.basePath+t.replace(/\./g,"/")+"."+o;return r},persist:{checkPersist:function(){return window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB?"database":window.localStorage?"storage":null},empty:{getAll:function(){return t.promise(function(t){t({})})},saveAll:function(){return t.promise(function(t){t()})},clean:function(){return t.promise(function(t){t()})}},storage:{getAll:function(){var e={};try{e=window.localStorage.getItem("topolr-local-source")}catch(n){}return t.promise(function(t){t(e)})},saveAll:function(e){try{window.localStorage.setItem("topolr-local-source",window.JSON.stringify(e))}catch(n){}return t.promise(function(t){t()})},clean:function(){try{window.localStorage.removeItem("topolr-local-source")}catch(e){}return t.promise(function(t){t()})}},database:{db:null,info:{name:"topolr",version:1,store:"topolr-local-source",key:"name",value:"local"},init:function(){var e=t.promise();window.indexedDB||(window.indexedDB=window.mozIndexedDB||window.webkitIndexedDB);var n=indexedDB.open(N.persist.database.info.name,N.persist.database.info.version);return n.onupgradeneeded=function(t){var e=n.result;e.objectStoreNames.contains(N.persist.database.info.store)&&e.deleteObjectStore(N.persist.database.info.store);var r=e.createObjectStore(N.persist.database.info.store,{keyPath:N.persist.database.info.key});r.put({name:N.persist.database.info.value,data:{}})},n.onsuccess=function(t){N.persist.database.db=n.result,e.resolve()},n.onerror=function(){e.resolve()},e},getAll:function(){var e=function(){var e=t.promise();if(N.persist.database.db){var n=N.persist.database.db.transaction([N.persist.database.info.store],"readwrite");n.onerror=function(t){e.resolve({})};var r=n.objectStore(N.persist.database.info.store).get(N.persist.database.info.value);r.onerror=function(t){e.resolve({})},r.onsuccess=function(t){e.resolve(r.result?r.result.data:{})}}else e.resolve({});return e};return N.persist.database.db?e():N.persist.database.init().then(function(){return e()},function(t){return console.error(t),t})},saveAll:function(e){var n=function(){var n=t.promise();if(N.persist.database.db){var r=N.persist.database.db.transaction([N.persist.database.info.store],"readwrite");r.oncomplete=function(t){n.resolve()},r.onerror=function(t){n.resolve()},r.objectStore(N.persist.database.info.store).put({name:N.persist.database.info.value,data:e})}else n.resolve();return n};return N.persist.database.db?n():N.persist.database.init().then(function(){return n()},function(t){return console.error(t),t})},clean:function(){var e=function(){var e=t.promise();if(N.persist.database.db){var n=N.persist.database.db.transaction([N.persist.database.info.store],"readwrite");n.oncomplete=function(t){e.resolve()},n.onerror=function(t){e.resolve()},n.objectStore(N.persist.database.info.store)["delete"](N.persist.database.info.value)}else e.resolve();return e};return N.persist.database.db?e():N.persist.database.init().then(function(){return e()},function(t){return console.error(t),t})}}},loader:{compress:function(e){return t.ajax({url:e,method:"get",dataType:"text"}).then(function(t){return JSON.parse(t.substring(21,t.length-2))},function(t){return console.error(t),t})},text:function(e){return t.ajax({url:e,method:"get",dataType:"text"})},nothing:function(e){return t.promise(function(t){t(e)})},code:function(t){return N.loader.text(t)}},parser:{path:function(t,e){return t},content:function(t,e){return e},code:function(t,e){return{path:t,code:e}},css:function(t,e){return e=e.replace(/url\(.+?\)/g,function(e){var n=!1;return e=e.substring(4,e.length-1).trim(),("'"===e[0]||'"'===e[0])&&(e=e.substring(1,e.length-1),n=!0),0===e.indexOf("http:")||0===e.indexOf("data:")||0===e.indexOf("https:")?e:n?'url("'+N.path.getRelativePath(t,e)+'")':"url("+N.path.getRelativePath(t,e)+")"}),{path:t,code:e}},html:function(t,e){return e=e.replace(E.f,"><").replace(E.i,"").replace(E.k,"").replace(E.l,""),e=e.replace(/src=['"].+?['"]/g,function(t){if(t=t.trim(),-1===t.indexOf("<%")){var e=t.substring(5,t.length-1);return 0===e.indexOf("http:")||0===e.indexOf("data:")||0===e.indexOf("https:")?'src="'+e+'"':'src="'+N.basePath+e+'"'}return t})},template:function(t,e){e=N.parser.html(t,e);for(var n={},r=e.split(E.isNotep),i=e.match(E.isNotes),o=0;o<i.length;o++){var s=i[o].substring(5,i[o].length-4);n[s]=r[o+1].replace(E.isNotec,"")}return n}},trigger:{js:function(e,n){return t.promise(function(t){try{new Function("window","console",e.code).call(window,window,window.console)}catch(n){console.error(n)}t()})},css:function(e,n){return t.promise(function(t){for(var r=document.getElementsByTagName("style"),i=!1,o=0;o<r.length;o++)r[o].dataset&&r[o].dataset.packet===n&&(i=!0);if(i)t();else{var s=(e.path,document.createElement("style"));s.setAttribute("media","screen"),s.setAttribute("type","text/css"),s.setAttribute("data-packet",n),s.appendChild(document.createTextNode(e.code)),document.getElementsByTagName("head")[0].appendChild(s),t()}})},code:function(e,n){return t.promise(function(t){t(e.code)})},text:function(e,n){return t.promise(function(t){t(e)})},image:function(e,n){var r=e.path,i=t.promise(),o=document.createElement("img"),s=function(t){t.target.removeEventListener("load",s),t.target.removeEventListener("error",a),i.resolve(t.target)},a=function(t){t.target.removeEventListener("load",s),t.target.removeEventListener("error",a),i.reject(t)};return o.src=r,o.addEventListener("load",s,!1),o.addEventListener("error",a,!1),i},json:function(e,n){return t.promise(function(t){t(JSON.parse(e))})}},path:{getCurrentPath:function(t){if("/"===t[t.length-1])return t;var e=t.split("/");return e.pop(),e.join("/")+"/"},getParentPath:function(t,e){if(console.log(">>  "+e),void 0===e&&(e=1),e>0){"/"===t[t.length-1]&&e++;var n=t.split("/");return n.splice(n.length-e,e),n.join("/")+"/"}return t},getRelativePath:function(t,e){t=N.path.getCurrentPath(t);var n=e.match(/^(\.{0,2}\/)+/);if(n){if(e=e.substring(n[0].length),"/"===n[0])return t+e.substring(1);var r=n[0].split("/"),i=r.length-1;return"."===r[0]?(i-=1,N.path.getParentPath(t,i)+e):N.path.getParentPath(t,i)+e}return t+e}},appender:{beforeinit:{},append:function(t){for(var e in t){N.appender.beforeinit[e]||(N.appender.beforeinit[e]=[]);for(var n in t[e])N.appender.beforeinit[e].push(t[e][n])}},excute:function(t){for(var e in t)for(var n=e,r=t[e],i=0;i<r.length;i++){var o=r[i],s=N.getProcessor(n).parser,a=N.parser[s](N.getPacketPath(o.p,n),o.c);N.local[n][o.p]={hash:o.h,content:a}}},appendSource:function(t){N.ready?N.appender.excute(t):N.appender.append(t)},appendInit:function(){N.appender.excute(N.appender.beforeinit),N.appender.beforeinit={}}}};t.source=function(t){N.appender.appendSource(t)};var O=function(){this._packets_={},this.exports={},this._depends=[],this.children=[],this.packet="",this.require=[],this.include=[],this.template=[],this.js=[],this.css=[],this.html=[],this.json=[],this.image=[],this.text=[],this.usestrict=!1};O.prototype.getTemplate=function(t,e){for(var n in this.template)if(this.template[n].packet===t)return"<!--("+t+"."+e+")-->"+(this.template[n].value[e]||"")},O.prototype.getJson=function(t){for(var e in this.json)if(this.json[e].packet===t)return this.json[e].value||{}},O.prototype.getImage=function(t){for(var e in this.image)if(this.image[e].packet===t)return this.image[e].value||{}},O.prototype.getHtml=function(t){for(var e in this.html)if(this.html[e].packet===t)return this.html[e].value||{}},O.prototype.getText=function(t){for(var e in this.text)if(this.text[e].packet===t)return this.text[e].value||{}},O.prototype.getChildren=function(){for(var t=[],e=0;e<this.children.length;e++)t.push(E.requiremapping[this.children[e]]);return t},O.prototype.getMapSource=function(t){var e=null,n=t.split(".");n.pop();for(var r=n.join("."),i=0;i<this.map.length;i++){var o=this.map[i];if(o.folder){if(r===o.packet){e=o;break}}else if(t===o.packet){e=o;break}}if(e)return N.get(t,e.sourceType);throw Error("[topolr] can not match the map packet of "+t)};var E=function(t){return E.run.call(this,t)};E.i=/\r\n/g,E.k=/\r/g,E.l=/\n/g,E.f=/>[\s]+</g,E.isdot=/\./g,E.issuffix=/\[.*\]/g,E.isNote=/\/\*[\w\W]*?\*\//,E.isNoteall=/\/\*[\w\W]*?\*\//g,E.isInfo=/@([\s\S]*?);/g,E.isPacketTag=/["\']@[A-Za-z0-9_\[\]-]+\.[A-Za-z0-9_-]*["\']/g,E.isCurrentTag=/["\']@\.[A-Za-z0-9_-]+["\']/g,E.isMapTag=/["\']@[A-Za-z0-9_\[\]-]+\.[A-Za-z\[\]0-9_-]*["\']/g,E.isPacket=/["\']@[A-Za-z0-9_\[\]-]+["\']/g,E.isOther=/["\']\\@[A-Za-z0-9_-]+["\']/g,E.isNotep=/\<\!\-\-\[[0-9a-zA-Z-_]*?\]\-\-\>/,E.isNotes=/\<\!\-\-\[[0-9a-zA-Z-_]*?\]\-\-\>/g,E.isNotec=/\<\!\-\-[\s\S]*?\-\-\>/g,E.isNotet=/\<\!\-\-\[@[\s\S]*?;\]\-\-\>/,E.isNotets=/\<\!\-\-\[@[\s\S]*?;\]\-\-\>/g,E.isCssPath=/url\(.+?\)/g,E.issuffixp=/\[|\]/,E.requiremapping={},E.packetDone=[],E.mapping={packet:"js",html:"html",template:"html",js:"js",css:"css",text:"txt",json:"json",image:"png",include:"js",require:"js"},E.packetsmapping={},E.deleteR=function(t,e){if(k.option.debug){e||(e=3);for(var n=0,r="",i=0,o=t.length;o>i;i++)"\n"===t[i]||"\r"===t[i]?(n>e&&(r+=t[i]),n++):r+=t[i];return r}return t},E.run=function(e){this.info=[];var n=this,r=t.promise();return this.load(e).done(function(){var e=E.dependsSort.call(n,n.info);if(e.length!==n.info.length)throw Error("[topolr] packets depend error,maybe cyclic dependency or some file has no packet info.");n.info=e;for(var i=0;i<n.info.length;i++){var o=n.info[i].info;if(!E.requiremapping[o.packet]){E.requiremapping[o.packet]=o;var s=E.deleteR(n.info[i].code)+"!$.is.isEmptyObject(exports)?(module.exports=exports):'';";"true"===o.usestrict&&(o.usestrict=!0),k.option.debug&&(s=(o.usestrict?'"use strict";':"")+s+"//# sourceURL="+o.path.split("?")[0]);try{o.sitePath=k.option.sitePath,o.basePath=k.option.basePath,o.currentPath=N.path.getCurrentPath(o.path),new Function("window","$","Module","Option","module","exports","require","sitePath","App","console",s).call(o,window,t,function(e){e.packet=o.packet,t.Module(e)},function(e){e.name=o.packet?o.packet+"."+e.name:e.name,t.Option(e,o.packet)},o,{},function(t){var e=E.requiremapping[t];if(e)return e.exports;throw Error("[topolr] method require() called error,packet of "+t+" is not required in packet of "+o.packet)},k.option.sitePath,window.App,window.console),E.packetsmapping[o.packet]=o}catch(a){console.error("[topolr] packet import error name of "+o.packet+" path of "+o.path+" Message:"+a.stack)}}}r.resolve(),n.clean()}),r},E.dependsSort=function(t){for(var e=[],n=[],r=0;r<t.length;r++){var i=t[r];i.dependTimes=i.info._depends.length;for(var o=0;o<i.info._depends.length;o++){var s=i.info._depends[o];-1!==E.packetDone.indexOf(s)&&(i.dependTimes=i.dependTimes-1)}}for(var r=0;r<t.length;r++){var i=t[r];0===i.dependTimes||0===i.info._depends.length?(E.packetDone.push(i.info.packet),e.push(i)):(i.dependTimes=i.info._depends.length,n.push(i))}for(var r=0;r<e.length;r++)for(var i=e[r],o=0;o<n.length;o++){var a=n[o];if(-1!==a.info._depends.indexOf(i.info.packet)&&(a.dependTimes=a.dependTimes-1,a.dependTimes<=0)){E.packetDone.push(a.info.packet),e.push(a),n.splice(o,1);break}}for(var r=0;r<n.length;r++)for(var i=n[r],o=0;o<i.info._depends.length;o++){var a=i.info._depends[o];if(-1!==E.packetDone.indexOf(a)&&(i.dependTimes=i.dependTimes-1,i.dependTimes<=0)){E.packetDone.push(i.info.packet),e.push(i),n.splice(r,1);break}}return e},E.getPacketInfo=function(t){var e=t.match(E.isNote),n=(k.option.basePath,new O);if(e&&e.length>0)for(var r=e[0],i=r.match(E.isInfo),o=0;o<i.length;o++){var e=i[o],s=e.split(" ");if(s.length>=2){var a=s[0].substring(1,s[0].length),l=";"===s[1][s[1].length-1]?s[1].substring(0,s[1].length-1):s[1],u=(l.split(E.issuffixp)[1]||"",l.split(":")[1]?l.split(":")[1]:l.split(".").pop());"image"!==a&&"text"!==a&&"map"!==a&&(l=l.replace(E.issuffix,"")),l=l.split(":")[0];var h=N.getPacketPath(l,E.mapping[a]),c={packet:l,path:h,value:null};if("packet"===a&&(n.packet=l,n.path=h),"require"===a&&(n._depends.push(l),n.children.push(l)),"include"===a&&n.children.push(l),"js"===a&&-1!==l.indexOf("http")&&(c.path=l),"map"===a){var e=l.split(/\(|\)/);c="*"===e[2][e[2].length-1]?{sourceType:e[1],packet:e[2].substring(0,e[2].length-2),folder:!0}:{sourceType:e[1],packet:e[2],folder:!1},l=e[2]}n[a]||(n[a]=[]),-1===n[a].indexOf(c)&&n[a].push&&n[a].push(c),n._packets_[u]=l}}else n.packet="nopacket";return n},E.replacePacketNames=function(t,e){return e.replace(E.isPacketTag,function(e){var n=e.split("."),r=0,i=n[1].substring(0,n[1].length-1),r=n[0].substring(2);if(t._packets_[r]){if(-1===t._packets_[r].indexOf("*"))return e[0]+t._packets_[r]+"."+i+e[e.length-1];var n=t._packets_[r].split(".");return n.pop(),e[0]+n.join(".")+"."+i+e[e.length-1]}throw Error("[topolr] packet can not find with tag of "+e+",packet is "+t.packet)}).replace(E.isCurrentTag,function(e){return e[0]+t.packet+"."+e.split(".")[1]}).replace(E.isPacket,function(e){var n=e.substring(2,e.length-1);if(t._packets_[n])return e[0]+t._packets_[n]+e[e.length-1];throw Error("[topolr] packet can not find with tag of "+e+",packet is "+t.packet)}).replace(E.isMapTag,function(e){var n=e.substring(1,e.length-1).split("."),r=n.shift().substring(1),i=t._packets_[r];if(i){var o=i.split(".");o.pop();var s=e[0]+o.join(".")+"."+n.pop()+e[e.length-1];return s}throw Error("[topolr] packet can not find with tag of "+e+",packet is "+t.packet)}).replace(E.isOther,function(t){return t.substring(1)})},E.prototype.load=function(e){var n=this,r=N.getPacketPath(e,"js"),i=t.promise();return N.get(e,"packet").then(function(e){var o=E.getPacketInfo.call(n,e);"nopacket"===o.packet&&console.error("[topolr] file has no packet info,path of "+r),n.info.push({info:o,code:E.replacePacketNames.call(n,o,e)});var s=["json","html","text","js","css","template","image"],a=t.queue();for(var l in s)for(var u=o[s[l]],h=0;h<u.length;h++)a.add(function(t,e){N.get(e.info.packet,e.type).done(function(t){e.info.value=t,a.next()})},function(t,e){console.error(e)},{info:u[h],type:s[l]});for(var h=0;h<o.require.length;h++)a.add(function(t,e){n.load(e.packet).done(function(){a.next()})},function(t,e){console.log(t)},{path:o.require[h].path,packet:o.require[h].packet});a.complete(function(){i.resolve()}).run()}).fail(function(t){console.error(t)}),i},E.prototype.clean=function(){for(var t in this)this[t]=null};var T=function(){};T.isSuper=/superClass\(.*?\)/g,T.superInvoke=function(t,e,n,r){if(t.__superinvoke__&&!t.__superinvoke__[e+n])return t.__superinvoke__[e+n]=1,T.superInvoke(t,t.__superinvoke__.current,n,r);if(t.__superinvoke__||(t.__superinvoke__={}),t.__superinvoke__[e+n]&&1!==t.__superinvoke__[e+n]||(t.__superinvoke__[e+n]={}),t.__superinvoke__[e+n].calling)return t.__superinvoke__[e+n].returns.shift();var i=Object.getPrototypeOf(t),o=null;if(e)for(;i;){if(i.__info__.name===e){o=i;break}i=Object.getPrototypeOf(i)}else o=t;if(o){t.__superinvoke__[e+n].returns=[],t.__superinvoke__[e+n].propName=n,t.__superinvoke__[e+n].current="";for(var s=[],a=[];o;){var l=o[n].toString().match(T.isSuper);if(!(l&&l.length>0)){s.push(o[n]),a.push(o.__info__.name);break}for(var u=0;u<l.length;u++){var h=l[u].substring(12,l[u].length-2),c=h.split(",").shift();c=c.substring(1,c.length-1),c===n&&(s.push(o[n]),a.push(o.__info__.name))}o=Object.getPrototypeOf(o)}s.length>1&&(s.shift(),s.reverse(),a.shift(),a.reverse());var p=null;t.__superinvoke__[e+n].calling=!0;for(var u=0;u<s.length;u++){t.__superinvoke__.current=a[u];var d=s[u].apply(t,r);t.__superinvoke__[e+n].returns.push(d),p=d}t.__superinvoke__[e+n].calling=!1,t.__superinvoke__[e+n].returns=[],t.__superinvoke__[e+n]=null;var f=!0;for(var u in t.__superinvoke__)"current"!==u&&null!==t.__superinvoke__[u]&&1!==t.__superinvoke__[u]&&(f=!1);return f&&(t.__superinvoke__=null),p}return null},Object.defineProperty(T.prototype,"__info__",{enumerable:!1,configurable:!1,writable:!1,value:{name:"adapt","short":"adapt","interface":null,"super":null,packet:null,types:["adapt"]}}),T.prototype.option={},T.prototype.privator=function(){var e=Array.prototype.slice.call(arguments),n=e.shift();return t.is.isFunction(this["_"+n])?this["_"+n].apply(this,e):this["_"+n]},T.prototype.staticor=function(){var e=Array.prototype.slice.call(arguments),n=e.shift();return t.is.isFunction(this["__"+n])?this["__"+n].apply(this,e):this["__"+n]},T.prototype.type=function(){return this.__info__.name},T.prototype.shortName=function(){return this.__info__["short"]},T.prototype.packet=function(){return this.__info__.packet},T.prototype.typeOf=function(t){for(var e=this,n=!1;e.__info__;){var r=e.__info__;if(-1!==r.types.indexOf(t)){n=!0;break}e=Object.getPrototypeOf(e)}return n},T.prototype.extendsOf=function(t){for(var e=this,n=!1;e.__info__;){if(e.__info__.name===t){n=!0;break}e=Object.getPrototypeOf(e)}return n},T.prototype.clean=function(){var t=["type","shortName","typeOf","extendsOf","packet"];for(var e in this)-1===t.indexOf(e)&&(this[e]=null)},T.prototype.superClass=function(t){t||(t="init");var e="",n=Object.keys(this);-1===n.indexOf(t)&&(e=Object.getPrototypeOf(this).__info__.name);var r=Array.prototype.slice.call(arguments);return r.shift(),T.superInvoke(this,e,t,r)},T.prototype.instanceId=function(){return this._instanceId||(this._instanceId=s.randomid(10)),this._instanceId};var j=function(){this._mapping={adapt:T}};j.set=function(t,e){for(var n in e)Object.defineProperty(t,n,{enumerable:!1,configurable:!1,writable:!1,value:e[n]});return t},j.prototype.def=function(e){e.extend?t.is.isString(e.extend)&&(e.extend=[e.extend]):e.extend=["adapt"];var n=new this._mapping[e.extend[0]],r=Object.getPrototypeOf(n),i=[e.option],o=[e.services||{}];i.push(r.option?t.json.clone(r.option):{}),o.push(r.services?t.json.clone(r.services):{});var s=[],a=[e.packet?e.packet+"."+e.name:e.name];if(e.extend.length>1){a.push(e.extend.shift());for(var l=0;l<e.extend.length;l++){var u=e.extend[l],h=this._mapping[u];if(h){s.push(u);for(var c=Object.keys(h.prototype),p=0;p<c.length;p++){var d=c[p];"option"!==d&&"init"!==d&&"services"!==d&&(n[d]=h.prototype[d])}i.push(t.json.clone(h.prototype.option)),o.push(t.extend({},h.prototype.services))}}}i.reverse(),i.unshift({}),i.unshift(!0),n.option=t.extend.apply({},i),o.reverse(),o.unshift({}),o.unshift(!0),n.services=t.extend.apply({},o);var f=["name","extend","shortName","packet","option","services"];for(var l in e)-1===f.indexOf(l)&&(n[l]=e[l]);n.init||(n.init=function(){});var g=a.concat(e.extend);if(this._mapping[e.extend[0]].prototype.__info__)for(var l in this._mapping[e.extend[0]].prototype.__info__.types){var u=this._mapping[e.extend[0]].prototype.__info__.types[l];-1===g.indexOf(u)&&g.push(u)}j.set(n,{__info__:j.set({},{name:e.packet?e.packet+"."+e.name:e.name,"short":e.name||"",packet:e.packet||"","interface":s,"super":a.join(""),types:g})});var v=function(){};return v.prototype=n,this._mapping[n.__info__.name]=v,this},j.prototype.get=function(t){return this._mapping[t]},j.prototype.create=function(t,e){var n=this.instance(t,e);if(n)for(var r=n.__info__.types.length-1;r>=0;r--){var i=this._mapping[n.__info__.types[r]];i&&i.prototype.init&&i.prototype.init.call(n,n.option)}return n},j.prototype.instance=function(e,n){var r=null,i=e,o=this._mapping[i];return o&&(r=new o,r.option=t.extend({},t.json.clone(o.prototype.option),n)),r},j.prototype.invoke=function(t,e,r){var i=null;if(n.isString(t)){var o=this._mapping[t];o&&(i=new o)}else n.isObject(t)&&(i=t);if(i&&i[e]&&n.isFunction(i[e])&&n.isObject(r)){var s=Array.prototype.slice.call(arguments),a=Object.keys(r),l=i;s.splice(0,3);for(var u=0;u<a.length;u++)l[a[u]]=r[a[u]];try{for(var h=l[e].apply(l,s),c=Object.keys(l),u=0;u<c.length;u++)r[c[u]]=l[c[u]];return h}catch(p){return console.error(p.stack),null}}return null},j.prototype.has=function(t){return void 0!==this._mapping[t]},t.adapt=function(){return new j};var S=function(t,e){this.tag=t||"",this.props=e||{},this.hasProp=!1,this.children=[],this.parent=null};S.filter=function(t){return t=t.trim(),t.replace(S.isNote,"").replace(S.isDoctype,"").replace(S.isXmlTag,"")},S.repairTag=function(t){for(var e=["br","hr","img","input","param","link","meta","area","base","basefont","param","col","frame","embed","keygen","source"],n=0;n<e.length;n++){var r=new RegExp("<"+e[n]+" .*?>","g");t=t.replace(r,function(t){return t.substring(0,t.length-1)+"/>"})}return t},S.parse=function(t){if(t&&""!==t){t=A.filter(t),t=S.repairTag(t);for(var e=[],n=[],r=null,i="",o="",s="",a="",l="",u=!1,h=!1,c=!1,p=!1,d=!1,f=0,g=t.length;g>f;f++){var v=t[f];if("\r"!==v&&"\n"!==v){if("<"===v){d=!0,""!==l.trim()&&(r=new C(l.trim(),e[e.length-1]||null),e[e.length-1]?e[e.length-1].children.push(r):n.push(r),l=""),t[f+1]&&"/"===t[f+1]?p=!0:(r=new S,e.push(r),e.length-2>=0&&(e[e.length-2].children.push(r),r.parent=e[e.length-2]),u=!0);continue}if(" "===v){if(d&&(u&&(u=!1,r.tag=i.trim(),i=""),!h&&!c)){h=!0;continue}}else if("="===v)d&&(h=!1);else if("'"===v||'"'===v){if(!c&&d){c=v;continue}c===v&&(c=!1,r.hasProp=!0,r.props[s.trim()]=a.trim(),s="",a="")}else{if(">"===v){d=!1,h=!1,c=!1,u=!1,p&&(p=!1,o="",1===e.length&&n.push(e[0]),e.pop()),r.hasProp||(""===r.tag&&(r.tag=i.trim()),i="");continue}if("/"===v){t[f+1]&&">"===t[f+1]?(d=!1,c=!1,h=!1,p=!1,u=!1,o="",1===e.length&&n.push(e[0]),r.hasProp||(""===r.tag&&(r.tag=i.trim()),i=""),e.pop()):!d&&(l+=v);continue}}u&&(i+=v),h&&(s+=v),c&&(a+=v),p&&(o+=v),!d&&(l+=v)}}return l&&n.push(new C(l,null)),n}return[]},S.prototype.hasCode=function(){return!1},S.prototype.code=function(t){var e="",n="";this.parent?(e="__$$node$$"+t,n='{tag:"'+this.tag+'",props:'+JSON.stringify(this.props)+",children:[]};",n+="__$$$current="+e+";"):(e="__$$node$$"+t,n="var "+e+'={tag:"'+this.tag+'",props:'+JSON.stringify(this.props)+",children:[]};",n+="__$$$current="+e+";");for(var r=0,i=this.children.length;i>r;r++)if(this.children[r].hasCode())n+=this.children[r].content;else{var o="__$$node$$"+(t+1);t+=1,n+="var "+o+"="+this.children[r].code(t),n+=e+".children.push("+o+");",n+="__$$$current="+e+";"}return n};var C=function(t,e){this.content=t,this.parent=e};C.prototype.code=function(t){return this.hasCode()?this.content:'{content:"'+this.content+'"};'},C.prototype.hasCode=function(){return/\(\[-code-\]\)/.test(this.content)};var A=function(e,n,r,i){if(k.option.debug){var o=e.match(A.h);o?(this._pid=o[0].substring(5,o[0].length-4),this._path=k.option.basePath+this._pid.replace(/\./g,"/")+".js"):(this._pid="tempcompile/template-"+e.length,this._path=k.option.basePath+this._pid+".js")}e=A.cache(e);var s=A.precompile(e,i);this._scope=s.info,this._code=A.code.call(this,s.template),this._fn=A.compile(this._code,r),this._autodom=i,i&&(this._autocode=A.autocode.call(this,s.virtemplate),this._autocodefn=A.autocompile(this._autocode,r)),this._session=null,this._caching={},this._macrofn=n||{},this._isupdate=!1,this._source=e,this._parameters=r,t.extend(this._macrofn,A.globalMacro)};A.z=/\<\!\-\-\([0-9a-zA-Z-_]*?\)\-\-\>/,A.a=/&lt;/g,A.b=/&gt;/g,A.c=/&quot;/g,A.d=/<%|%>/g,A.e=/^=.*;$/,A.f=/>[\s]+</g,A.g=/\{\{.*\}\}/,A.h=/\<\!\-\-[\s\S]*?\-\-\>/g,A.j=/\{\{|\}\}/,A.i=/\r\n/g,A.k=/\r/g,A.l=/\n/g,A.m=/"/g,A.ch=/@cache\(.*?\)/g,A.isDoctype=/\<\!DOCTYPE[\s\S]*?\>/g,A.isNote=/\<\!\-\-[\s\S]*?\-\-\>/g,A.isXmlTag=/\<\?[\s\S]*?\?\>/g,A.filter=function(t){return t=t.trim(),t.replace(A.isNote,"").replace(A.isDoctype,"").replace(A.isXmlTag,"")},A.diff=function(t,e){var n={add:[],replace:[],remove:[],edit:[],removeAll:[],bremove:[]},r=[];return A.diffNode(t,e,r,n),e.length=0,n},A.diffNode=function(t,e,n,r){if(t&&e){var i=t.length;if(0===t.length)0!==e.length&&r.removeAll.push({path:n.join(",")});else{if(t.length<e.length)if(t[0].props&&t[0].props.unique){for(var o=A.checkRemove(t,e),s=[],a=0,l=o.length;l>a;a++)s.push(e[o[a]]),r.bremove.push({path:n.join(",")+","+o[a]});for(var a=0,l=s.length;l>a;a++)e.splice(e.indexOf(s[a]),1)}else i=e.length;for(var a=0;i>a;a++){if(n.push(a),t[a])if(e[a]){if(!t[a].props||void 0===t[a].props["data-view"]){var u=A.checkNode(t[a],e[a]);u===!0?A.diffNode(t[a].children,e[a].children,n,r):"replace"===u?r.replace.push({path:n.join(","),node:t[a]}):(r.edit.push({path:n.join(","),props:u}),A.diffNode(t[a].children,e[a].children,n,r))}}else r.add.push({path:n.join(","),node:t[a]});else r.remove.push({path:n.join(","),node:e[a]});n.pop()}}}},A.checkRemove=function(t,e){for(var n=[],r=[],i=0,o=t.length;o>i;i++)n.push(t[i].props.unique);for(var i=0,o=e.length;o>i;i++)-1===n.indexOf(e[i].props.unique)&&r.push(i);return r},A.checkNode=function(t,e){var n=!0;if(void 0!==t.content)n=t.content===e.content?!0:"replace";else{if(t.tag===e.tag)return A.checkProps(t.props,e.props);n="replace"}return n},A.checkProps=function(t,e){var n=Object.keys(t),r=Object.keys(e),i={"final":t},o=n.length,s=!1;n.length<r.length&&(o=r.length);for(var a=0;o>a;a++){var l=n[a];l?void 0===e[l]?s=!0:t[l]!==e[l]&&(s=!0):s=!0}return s?i:!0},A.element=function(t){if(void 0!==t.content)return window.document.createTextNode(t.content);var e=window.document.createElement(t.tag);for(var n in t.props)e.setAttribute(n,t.props[n]);for(var n=0;n<t.children.length;n++)e.appendChild(A.element(t.children[n]));return e},A.effect=function(t,e){k.option.debug&&console.log("Add:"+e.add.length+" Replace:"+e.replace.length+" Remove:"+e.remove.length+" Edit:"+e.edit.length+" removeAll:"+e.removeAll.length+" Bremove:"+e.bremove.length);for(var n=[],r=0,i=e.bremove.length;i>r;r++){for(var o=t.get(0),s=e.bremove[r].path.split(","),a=0,l=s.length;l>a;a++)o=o.childNodes[s[a]/1];n.push(o)}for(var r=0,i=n.length;i>r;r++)n[r].parentNode.removeChild(n[r]);for(var u=[],h={},r=0,i=e.replace.length;i>r;r++){for(var o=t.get(0),s=e.replace[r].path.split(","),c=!1,a=0,l=s.length;l>a;a++){var p=o.childNodes[s[a]/1];p?(o=p,c=!0):(c=!1,o.appendChild(A.element(e.replace[r].node)))}c&&o.parentNode.replaceChild(A.element(e.replace[r].node),o)}for(var r=0,i=e.add.length;i>r;r++){var o=t.get(0),s=e.add[r].path.split(",");s.pop();for(var d=s.join(""),a=0,l=s.length;l>a;a++)o=o.childNodes[s[a]/1];h[d]?h[d].push({p:o,n:e.add[r].node}):h[d]=[{p:o,n:e.add[r].node}]}for(var r=0,i=e.remove.length;i>r;r++){for(var o=t.get(0),s=e.remove[r].path.split(","),f=s.pop(),a=0,l=s.length;l>a;a++)o=o.childNodes[s[a]/1];u.push(o.childNodes[f])}for(var r=0,i=e.edit.length;i>r;r++){var o=t.get(0),s=e.edit[r].path.split(",");for(var a in s)o=o.childNodes[s[a]/1];var g=e.edit[r].props,v=Array.prototype.slice.call(o.attributes);for(var a in g["final"])o.setAttribute(a,g["final"][a]),v.splice(v.indexOf(a),1);for(var a=0;a<v.length;a++)o.removeAttribute(v[a])}for(var r=0,i=u.length;i>r;r++)u[r].parentNode.removeChild(u[r]);for(var r=0,i=e.removeAll.length;i>r;r++){for(var o=t.get(0),s=e.removeAll[r].path.split(","),a=0,l=s.length;l>a;a++)o&&(o=o.childNodes[s[a]/1]);o&&(o.innerHTML="")}for(var r in h)if(h[r].length>0){for(var m=window.document.createDocumentFragment(),o=0,i=h[r].length;i>o;o++)m.appendChild(A.element(h[r][o].n));h[r][0].p.appendChild(m)}else h[r].p.appendChild(A.element(h[r].n))},A.globalMacro={include:function(t,e,n){return this.renderInContext(t.template)},self:function(t,e,n){return this.renderInContext(this._source,t.data)}},A.code=function(t){var e="",n="__$$out$$+";k.option.debug&&(e="/* template source:\r\n"+t+"*/\r\n\r\n",e+="/* compile code:*/\r\n",n="\r\n__$$out$$+"),e+="var __$$out$$='';";for(var r=t.split(A.d),i=0;i<r.length;i++){var o=r[i];e+=i%2!==0?A.e.test(o)?n+"=(("+o.substring(1,o.length-1)+")||'');":o:n+'="'+o.replace(A.m,'\\"')+'";'}return e+="return __$$out$$;",k.option.debug&&(e+="//# sourceURL="+this._path),e},A.autocode=function(t){for(var e="",n="",r=[],i=[],o=t.replace(A.a,"<%").replace(A.b,"%>").split(A.d),s=0;s<o.length;s++){
var a=o[s];s%2!==0?A.e.test(a)?(e+=n+"[[-code-]]",r.push(a)):(e+="(([-code-]))",i.push(a)):e+=n+a}for(var l=S.parse(e),u='"use strict";\r\nvar __$$r$$=[],__$$$current=null;\r\n',h=0,c=l.length;c>h;h++){var p=h+"_0",d=l[h].code(p);u+=d+"\r\n",-1!==d.indexOf("__$$node$$"+p)&&-1===d.indexOf("__$$r$$.push(__$$node$$"+p+")")&&(u+="__$$r$$.push(__$$node$$"+p+");\r\n")}return u=u.replace(/\(\(\[-code-\]\)\)/g,function(t,e,n){var r=i.shift();return r}).replace(/\[\[-code-\]\]/g,function(t,e,n){var i=r.shift();return i&&"="===i[0]?'"+(('+i.substring(1,i.length-1)+")||'')+\"":i}).replace(/\{\{node\}\}/g,function(t,e,n){return"__$$$current"}),u+="return __$$r$$;",k.option.debug&&(u+="//# sourceURL="+this._path.substring(0,this._path.length-3)+"-autodom.js"),u},A.compile=function(t,e){try{var n=[];if(e)for(var r=0;r<e.length;r++)n.push(e[r]);else n=["data"];var i=function(t,e){function n(){return t.apply(this,e)}return n.prototype=t.prototype,new n};return n.push(t),n.unshift("window"),n.unshift("$"),n.unshift("__$$$node$$$"),i(Function,n)}catch(o){return console.error("[template compile error] \r\n"+o.stack+"\r\n"+t),function(){return""}}},A.autocompile=function(t,e){return e||(e=["data"]),A.compile(t,e)},A.exceute=function(t,e){var n="";this._session=e;try{this._session.unshift(window),this._session.unshift(window.topolr),this._session.unshift(S),n=t.apply(this,this._session)}catch(r){console.error("[topolr] template render called error, Message:"+r.stack)}return n},A.precompile=function(t,e){if(t=t.replace(A.a,"<").replace(A.b,">").replace(A.h,"").replace(A.f,"><").replace(A.i,"").replace(A.k,"").replace(A.l,""),-1!==t.indexOf("<@")){for(var n,r=-1,i="",o="start",s="",a="",l="",u=!0,h="",c={},p=0,d=0,f=0,g=0,v=[];r<t.length;)r++,i=t[r],"start"!==o||"<"!==i||"@"!==t[r+1]?"tagstart"!==o||"@"!==i?"start"!==o||"<"!==i||"/"!==t[r+1]||"@"!==t[r+2]?"endtag"!==o||">"!==i?"tagname"!==o||" "!==i?"tagname"!==o||"/"!==i&&">"!==i?"propname"!==o||"="!==i?"propvalue"!==o||"'"!==i&&'"'!==i?"propvalueing"!==o||i!==n?("endtag"===o&&(h+=i),"tagname"===o&&(s+=i),"propname"===o&&(a+=i),"propvalueing"===o&&(l+=i)):(o="tagname",c[a]=l):(o="propvalueing",n=i,l=""):o="propvalue":(">"===i?(d=r+1,o="start",u=!0):"/"===i&&(d=r+2,o="start",u=!1),""!==s&&v.push({type:"tag",tagname:s,props:c,body:u,start:p,end:d})):(o="propname",a=""):(o="start",g=r+1,v.push({type:"endtag",tagname:h,start:f,end:g})):(f=r,o="endtag",h="",r+=2):(o="tagname",s="",c={}):(o="tagstart",p=r);var m=0,y=0,_=0,w=!1,i=null,b=[],k="",x="",N=0,O=[];for(var r in v)"tag"===v[r].type&&v[r].body===!1&&w===!1&&(v[r].bodystr="",v[r].from=v[r].start,v[r].to=v[r].end,b.push(v[r])),"tag"===v[r].type&&v[r].body===!0&&(w=!0,null===i&&(i=v[r],i.from=v[r].start),0===m&&(y=v[r].start,_=v[r].end),m++),"endtag"===v[r].type&&(m--,0===m&&(i.to=v[r].end,i.bodystr=t.substring(_,v[r].start),b.push(i),i=null,w=!1));for(var r in b){var E=b[r].props,T="";for(var j in E){var S=E[j];if(A.g.test(S)){for(var C=S.split(A.j),P="",q=1;q<=C.length;q++)q%2===0?""!==C[q-1]&&(P+=C[q-1]+"+"):P+=""!==C[q-1]?"'"+C[q-1]+"'+":C[q-1];var M=P.length>0?P.substring(0,P.length-1):"''";T+=j+":"+M+","}else T+=j+":'"+E[j]+"',"}b[r].parameter="{"+(T.length>0?T.substring(0,T.length-1):T)+"}",O.push({name:b[r].tagname,body:b[r].bodystr,parameter:b[r].parameter});var I=t.substring(N,b[r].from);k+=I,e&&(x+=I,x+="<%var tp=this._macro("+r+(""===b[r].parameter?"":","+b[r].parameter)+");if(tp){var c=__$$$node$$$.parse(tp);for(var ____$$$$i=0;____$$$$i<c.length;____$$$$i++){{{node}}.children.push(c[____$$$$i])}}else{{{node}}.children.push({content:''})}%>"),k+="<%=this._macro("+r+(""===b[r].parameter?"":","+b[r].parameter)+");%>",N=b[r].to}return k+=t.substring(N,t.length),e&&(x+=t.substring(N,t.length)),{template:k,virtemplate:x,info:O}}return{template:t,virtemplate:t,info:[]}},A.cache=function(t){return t.replace(A.ch,function(t){var e=t.substring(7,t.length-1);return"data-cache='<%=this._cache("+e+");%>'"})},A.prototype._cache=function(t){var e="";return n.isObject(t)||n.isArray(t)?t.__cacheid__?e=t.__cacheid__:(e=s.randomid(8),Object.defineProperty(t,"__cacheid__",{enumerable:!1,configurable:!1,writable:!1,value:e})):e=s.randomid(8),this._caching[e]=t,e},A.prototype._macro=function(t,e){var n=this._scope[t],r=this;return this._macrofn[n.name]?this._macrofn[n.name].call(this,e,function(t){if(""!==n.body){var e=[],i=[],o=[],s=[];for(var a in t)-1===r._parameters.indexOf(a)&&(e.push(a),i.push(t[a]));o=r._parameters.concat(e);for(var l=[],a=0;a<r._session.length;a++)a>2&&l.push(r._session[a]);s=l.concat(i);var u=new A(n.body,r._macrofn,o);return u._caching=r._caching,u.render.apply(u,s)}return""},""!==n.body):(console.error("[topolr] macro can not found ["+n.name+"] template is "+this._source),"")},A.prototype.session=function(){return 0===arguments.length?this._session:(this._session=arguments[0],this)},A.prototype.render=function(){return A.exceute.call(this,this._fn,Array.prototype.slice.call(arguments))},A.prototype.autoDom=function(){return this._isupdate?this._caching={}:this._isupdate=!0,A.exceute.call(this,this._autocodefn,Array.prototype.slice.call(arguments))},A.prototype.renderTo=function(){this._caching={};var t=Array.prototype.slice.call(arguments),e="",n=t.shift();e=A.exceute.call(this,this._fn,t),this.flush(n.html(e))},A.prototype.renderAppendTo=function(){this._caching={};var e=Array.prototype.slice.call(arguments),n="",r=e.shift();n=A.exceute.call(this,this._fn,e),this.flush(t(n).appendTo(r))},A.prototype.flush=function(t){t.data("--cache--",this._caching)},A.prototype.code=function(){return this._code},A.prototype.macro=function(t,e){return 1===arguments.length?this._macrofn=t||{}:2===arguments.length&&(this._macrofn[t]=e),this},A.prototype.clean=function(){this._caching.length=0;for(var t in this)this[t]=null},A.prototype.isAutodom=function(){return this._autodom},A.prototype.renderInContext=function(){for(var t=[],e=0;e<this._session.length;e++)t.push(this._session[e]);t.splice(0,3);for(var n=Array.prototype.slice.call(arguments),r=n.shift(),e=0;e<n.length;e++)t[e]=n[e];var i=new A(r,this._macrofn,this._parameters),o=i.render.apply(i,t);for(var e in i._caching)this._caching[e]=i._caching[e];return o},t.template=function(t,e,n,r){return new A(t,e,n,r)},t.setTemplateGlobalMacro=function(e,n){return 1===arguments.length?t.extend(A.globalMacro,e):2===arguments.length&&(A.globalMacro[e]=n),this},f.prototype.template=function(t,e){var n=new A(r.html(),e,t),r=this;return{render:function(t,e){return r.html(n.render(t,e)),r},compile:function(t,e){return n.render(t,e)}}};var P=function(e,r,i,o,s){this.dom=e,n.isString(r)?this.tempt=t.template(r,i,o,!0):this.tempt=r;var a=this.tempt.render.apply(this.tempt,s);this.virt=this.tempt.autoDom.apply(this.tempt,s),e.html(a),this.tempt.flush(e)};P.prototype.update=function(t){var e=this.tempt.autoDom.apply(this.tempt,t),n=A.diff(e,this.virt);this.virt=e,A.effect(this.dom,n),this.tempt.flush(this.dom)},P.prototype.clean=function(){for(var t in this)this[t]=null},f.prototype.autodom=function(t,e,n,r){return new P(this,t,e,n,r)};var M={regs:{a:/^(dom)|^(option)|^(name)|^(extend)|^(init)/},isMutation:function(){return null!==(window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver||null)},domInserted:function(e,n){var r=t(n);if(!r.dataset("parentView")){for(var i=!1;e&&e!==window.document;){if(e.datasets&&e.datasets["--view--"]){i=!0;break}e=e.parentNode}if(i){var o=e.datasets["--view--"];o.onnodeinserted&&o.onnodeinserted(n)}}},domRemoved:function(e,n){var r=t(n);if(!r.dataset("parentView")){for(var i=!1,o=e;e&&e!==window.document;){if(e.datasets&&e.datasets["--view--"]){i=!0;break}e=e.parentNode}if(i){var s=e.datasets["--view--"];s.onnoderemoved&&s.onnoderemoved(n,o)}}},factory:t.adapt(),getPacketName:function(t,e){if(t){if(t=t.trim(),""!==t){var n=t.split(".");return n.length>1?(n.pop(),n.join(".")):t}return""}return""},getArrayUnDuplicate:function(t){for(var e={},n=[],r=0;r<t.length;r++)e[t[r]]=1;for(var r in e)n.push(r);return n},getViewInstance:function(t,e,n){var r=t.dataset("view");if(!r)throw Error("[topolr] view can not init.the element has no attribute like view-*");M.get(r,e,function(e){t.data("--view--")?n&&n(t.data("--view--")):(e.dom=t,n&&n(e))})},add:function(t){t.tagName||(t.tagName="div"),M.factory.def(t);for(var e=(t.packet&&""!==t.packet?t.packet+".":"")+t.name,n=M.factory.get(e).prototype,r=[t.className||""],i=n.__info__.types.length-1;i>=0;i--){var o=M.factory.get(n.__info__.types[i]);if(o){var s=o.prototype.className;s&&""!==s&&-1===r.indexOf(s)&&r.push(s)}}n.fullClassName=r.join(" ")},has:function(t){return M.factory.has(t)},get:function(t,e,n){if(void 0===t||null===t||""===t)throw Error("[topolr] packet name can not undefined or null or ''.");if(M.has(t))n&&n(M.factory.instance(t,e));else{var r=M.getPacketName(t);new E(r).done(function(){if(n){if(!M.has(t))throw Error("[topolr] can not find module with name of "+t+",it is not in the packet of "+M.getPacketName(t)+" or the packet file inited failed.");n(M.factory.instance(t,e))}}).fail(function(t){console.error(t)})}},isPacketName:function(e){return t.is.isString(e)&&-1===e.indexOf("<")&&-1!==e.indexOf(".")},task:new u},I={options:{},add:function(t){if(!t.name||""===t.name)throw Error("[topolr] option name can not null or ''");I.options[t.name]=t.option},has:function(t){var e=I.options[t];return e?e:!1},get:function(t,e){if(void 0!==t&&""!==t&&"null"!==t)if("{"!==t[0]&&"["!==t[0]){var n=I.has(t);if(n===!1){var r=M.getPacketName(t);new E(r).done(function(){if(e){var n=I.has(t);if(!n)throw Error("[topolr] can not find option with name of "+t+",is not in the packet of "+M.getPacketName(t));e(n)}}).fail(function(t){console.error(t)})}else e&&e(n)}else{var i={};try{i=window.JSON.parse(t)}catch(o){}e&&e(i)}else e&&e(null)}},L=function(t,e,n){this.target=t,this.data=n,this.type=e,this._goon=!0,this.currentTarget=null};L.prototype.clone=function(){return t.extend(new viewevnet,this)},L.prototype.stopPropagation=function(){this._goon=!1};var $=function(){this._data=[]};$.handler=function(e){for(var n=e.target,r=e.currentTarget,i=r.datasets["--view--"];n&&n!==window;){if(n.datasets&&n.datasets["-eventback-"]){var o=n.datasets["-eventback-"][e.type];if(o&&i["bind_"+o]&&(e.stopPropagation=function(){this._ispropagation=!0},i["bind_"+o].call(i,t(n),e),e._ispropagation))break}if(n===r)break;n=n.parentNode}e.stopPropagation()},$.finder=function(e){for(var n=[],r=0;r<e._finders._data.length;r++)e.dom.get(0).contains(e._finders._data[r].get(0))&&n.push(e._finders._data[r]);e._finders._data=n,e.dom.find("[data-find]").each(function(){var n=this.dataset.find;this.datasets||(this.datasets={}),this.datasets["-finder-"]={name:n},this.removeAttribute("data-find"),this.setAttribute("find",n),e._finders._data.push(t(this));try{e["find_"+n]&&e["find_"+n](t(this),e._finders)}catch(r){console.error("[topolr] view finder called error with module of "+e.type()+" Message:"+r.stack)}})},$.group=function(e){for(var n=[],r=0;r<e._groups._data.length;r++)e.dom.get(0).contains(e._groups._data[r].get(0))&&n.push(e._groups._data[r]);e._groups._data=n,e.dom.find("*[data-group]").each(function(){var n=t(this).dataset("group"),r={name:n,items:{}},i=t(this);if(t(this).data("-group-",r).removeAttr("data-group").attr("group",n),e._groups._data.push(t(this)),t(this).find("*[data-groupi]").each(function(){r.items[t(this).dataset("groupi")]=t(this);var e=t(this).dataset("groupi");t(this).data("-groupitem-",{name:e,group:i}).removeAttr("data-groupi").attr("groupi",e)}),e["group_"+n])try{e["group_"+n](t(this))}catch(o){console.error("[topolr] view groups called error with module of "+e.type()+" Message:"+o.stack)}})},$.event=function(e){for(var n=[],r=[],i=0;i<e._binders._data.length;i++)e.dom.get(0).contains(e._binders._data[i].get(0))&&(n.push(e._binders._data[i]),r.push(e._binders._data[i].get(0)));e._binders._data=n,e.dom.find("[data-bind]").each(function(){if(-1===r.indexOf(this)){var n={},i=t(this).dataset("bind").split(" ");for(var o in i){var s=i[o].split(":"),a=s[0],l=s[1],u=e.dom.get(0);n[a]=l,(!u.events||u.events&&!u.events[a])&&e.dom.bind(a,$.handler)}this.datasets||(this.datasets={}),this.removeAttribute("data-bind"),this.datasets["-eventback-"]=n,e._binders._data.push(t(this))}})},$.delegate=function(t){$.finder(t),$.group(t),$.event(t)};var D=function(){};D["public"]={},D.localinstance={},D.getViewInfo=function(t){return{instanceId:t.instanceId(),type:t.type(),id:t.getId()}},D.getLocalInstance=function(e,n,r){if(M.factory.get(e).prototype.typeOf("localservice")){var i=D.getInstance(e,n),o=t.util.randomid(10);return i._localId=o,i.__creater__=r,D.localinstance[o]=i,o}return console.error("service "+e+" is not localservice"),null},D.setLocalService=function(e,n){var r=t.extend({},e.services);t.is.isArray(n)||(n=[n]);for(var i=0;i<n.length;i++){var o=D.localinstance[n[i]];if(o)for(var s in r){var a=r[s];if(t.is.isString(a)&&o.typeOf(a)){o._list.push(e),r[s]=o,e.services=r;try{o.onconnect&&o.onconnect(D.getViewInfo(e))}catch(l){console.error("[topolr] service onconnect error name is "+o.type()+" "+l.stack)}}else if(a.type&&a.type()&&o.typeOf(a.type())){if(o._list.push(e),r[s]=o,e.services=r,a._list&&-1!==a._list.indexOf(e)){a._list.splice(a._list.indexOf(e),1);try{a.ondisconnect&&a.ondisconnect(D.getViewInfo(e))}catch(l){console.error("[topolr] service ondisconnect error name is "+a.type()+" "+l.stack)}}try{o.onconnect&&o.onconnect(D.getViewInfo(e))}catch(l){console.error("[topolr] service onconnect error name is "+o.type()+" "+l.stack)}try{e.onservicechange&&e.onservicechange()}catch(l){console.error("[topolr] onservicechange called error of "+type.type())}}}}},D.cleanLocalInstance=function(t){var e={};for(var n in D.localinstance)D.localinstance[n].__creater__===t||D.localinstance[n].__creater__.isRemoved()?D.localinstance[n].clean():e[n]=D.localinstance[n];D.localinstance=e},D.getInstance=function(e,n){var r=M.factory.instance(e,t.extend({},n));t.extend(r,{_list:[],_queue:[],_isrunning:!1,_cache:{},data:{}});try{r.init()}catch(i){console.error("[topolr] service init called error name of "+e+" "+i.stack)}return r},D.get=function(t,e){var n=null;if(!M.has(t))throw Error("[topolr] service can not loaded,require service first "+t);return M.factory.get(t).prototype.typeOf("publicservice")?(D["public"][t]||(D["public"][t]=D.getInstance(t,e)),n=D["public"][t]):n=D.getInstance(t,e),n},D.init=function(e){var n=e.services,r={};for(var i in n)if(t.is.isString(n[i])){var o=D.get(n[i],e.option["service_"+i]);o._list.push(e),r[i]=o;try{o.onconnect&&o.onconnect(D.getViewInfo(e))}catch(s){console.error("[topolr] service onconnect error name is "+o.type()+" "+s.stack)}}else r[i]=n[i];e.services=r},D.clean=function(t){var e=t.services;for(var n in e){var r=e[n];if(r.init){var i=r._list.indexOf(t);if(-1!==i){r._list.splice(i,1);try{r.ondisconnect&&r.ondisconnect(D.getViewInfo(t))}catch(o){console.error("[topolr] service ondisconnect error name is "+q.type()+" "+o.stack)}}!r.typeOf&&r.typeOf("publicservice")&&r.clean(),r[n]=null}}},M.add({name:"data",_request:function(e,r,i){var o=t.promise(),s=!1;o.scope(this);var a={url:"",dataType:"json",data:""};if(t.extend(a,i),n.isString(e)?(s=!0,a.url=e):n.isObject(e)&&(s=!0,t.extend(a,e)),s)return a.data=r,this._doRequest(a,o),o;throw Error("[topolr] request parameter error")},_doRequest:function(e,n){t.ajax(e).done(function(t){t.code&&"1"===t.code?n.resolve(t.data):n.reject(t)}).fail(function(t){n.reject(t)})},getRequest:function(t,e){return this._request(t,e,{type:"get"})},postRequest:function(t,e){return this._request(t,e,{type:"post"})},putRequest:function(t,e){return this._request(t,e,{type:"put"})},deleteRequest:function(t,e){return this._request(t,e,"delete")},patchRequest:function(t,e){return this._request(t,e,"get")},setStorage:function(t,e){var n="",r=window.localStorage.getItem(this.type());return r?(r=window.JSON.parse(r),r[t]=e,n=window.JSON.stringify(r)):(r={},r[t]=e,n=window.JSON.stringify(r)),window.localStorage.setItem(this.type(),n),this},getStorage:function(t){var e=window.localStorage.getItem(this.type());return e=e?window.JSON.parse(e):{},e[t]},removeStorage:function(t){return this.setStorage(t,null)},cleanStorage:function(){return window.localStorage.removeItem(this.type()),this}}),M.add({name:"service",extend:"data",option:{reverse:!1},trigger:function(t,e){var n="schange",r=null;0===arguments.length?r=this.data:1===arguments.length?r=t:(n=t,r=e),n="service_"+n;for(var i=0,o=this._list.length;o>i;i++){var s=this._list[i];if(s[n])try{s[n](r)}catch(a){console.error("[topolr] service trigger called error name is "+s.type()+" view is "+s.type()+" "+a.stack)}}this._run()},triggerTo:function(t,e,n){var r="schange",i=null;0===arguments.length?i=this.data:1===arguments.length?i=n:(r=e,i=n),r="service_"+r;for(var o=0,s=this._list.length;s>o;o++){var a=this._list[o];if(a.instanceId()===t&&a[r])try{a[r](i)}catch(l){console.error("[topolr] service triggerTo called error name is "+a.type()+" view is "+a.type()+" "+l.stack)}}this._run()},start:function(){this._isrunning=!0,this._run()},stop:function(){this._isrunning=!1},isRunning:function(){return this._isrunning},cleanRepeatTask:function(){if(this._queue.length>0){for(var t=[this._queue[0]],e=1,n=this._queue.length;n>e;e++)for(var r=0,i=t.length;i>r;r++)!this._queue[e].type===t[r].type&&this._queue[e].target===t[r].target&&t.push(this._queue[e]);this._queue=t}},cleanTask:function(t){if(t){for(var e=[],n=0,r=this._queue.length;r>n;n++)this._queue[n].type===t&&e.push(this._queue[n]);this._queue=e}else this._queue=[],this._isrunning=!1},cache:function(t,e){return 0===arguments.length?this._cache.__default__:1===arguments.length?this._cache[t]:void(2===arguments.length&&(this._cache[t]=e))},getClientSize:function(){return this._list.length},clean:function(){try{this.onunload&&this.onunload()}catch(t){console.error("[topolr] onunload callback error name is "+service.type()+" "+t.stack)}this._list.length=0,this._queue.length=0;for(var e in this)"type"!==e&&(this[e]=null)},_trigger:function(e,n){var r=t.promise(),i={type:e,data:n.data,target:n.target,ps:r};return this.option.reverse?this._queue.unshift(i):this._queue.push(i),this._run(),r},_run:function(){if(this._queue.length>0&&this._isrunning===!0){var t=null,e=this;t=this.option.reverse?this._queue.shift():this._queue.pop(),t.ps.then(function(t){return e["service_"+t.type](t.data)},function(t){return console.error(t),t}).resolve(t)}},action_get:function(){return this.data},action_set:function(e){return t.extend(this.data,e),this}}),M.add({name:"publicservice",extend:"service"}),M.add({name:"privateservice",extend:"service"}),M.add({name:"localservice",extend:"service"}),M.add({name:"view",extend:"data",packet:"",option:{},parentView:null,marcos:{},services:[],autodom:!1,init:null,template:"",onbeforeinit:null,onendinit:null,onunload:t.nfn,onnoderemoved:null,onnodeinserted:null,onchildremove:null,onservicechange:null,_render:function(e){if(!this.dom.data("--view--")){if(this._rendered=!1,M.isPacketName(this.template)){var n=this.template.split("."),r=n.pop(),i=n.join(".");this.template=E.packetsmapping[this.packet()].getTemplate(i,r)}this.dom.data("--view--",this),this._finders=new $,this._groups=new $,this._binders=new $,this.dom.children().length>0&&(this.template=this.dom.html());var o=this.dom.dataset("option"),s=this;if(this.dom.hasClass("_futuretochange_")){this.dom.removeClass("_futuretochange_");var a=M.factory._mapping[this.type()].prototype,l=a.fullClassName;if(this.dom.get(0).tagName.toLowerCase()!==this.tagName){var n=t("<"+a.tagName+" class='"+l+"' data-view='"+this.dom.dataset("view")+"' data-parent-view='"+this.dom.dataset("parentView")+"' data-view-id='"+this.dom.dataset("viewId")+"' daa-option='"+this.dom.dataset("option")+"'></"+a.tagName+">");this.dom.get(0).parentNode.replaceChild(n.get(0),this.dom.get(0)),this.dom=n}}this._handlers=[],I.get(o,function(t){if(t){s.option.override=t.override||{};for(var n in t)"override"!==n&&(0===n.indexOf("override_")?s.option.override[n.substring(9)]=t[n]:s.option[n]=t[n])}for(var n in s.option.override)M.regs.a.test(n)||(s[n]=s.option.override[n]);if(s.name=s.type(),s.shortname=s.shortName(),"function"==typeof s.onbeforeinit)try{s.onbeforeinit(s.option)}catch(r){console.error("[topolr] onbeforeinit called error with module of "+s.type()+" Message:"+r.stack)}if(s.className&&""!==s.className&&s.dom.addClass(s.className),D.init(s),"function"==typeof s.init)try{s.init(s.option)}catch(r){console.error("[topolr] init called error with module of "+s.type()+" Message:"+r.stack)}if("function"==typeof s.onendinit)try{s.onendinit(s.option)}catch(r){console.error("[topolr] onendinit called error with module of "+s.type()+" Message:"+r.stack)}e&&e()})}return this},getId:function(){return this.dom.dataset("viewId")},getDom:function(){return this.dom},request:function(e){return t.ajax(e)},triggerEvent:function(t){return t.currentTarget=this,this._handlers[t.type]?this._handlers[t.type].call(this,t):this["event_"+t.type]?this["event_"+t.type].call(this,t):!0},initEvent:function(t,e){var n=new L(this,t,e);return n},dispatchEvent:function(t,e,n){n=void 0===n?!0:n;var r=new L(this,t,e);if(n===!0)for(var i=this;i&&(i.triggerEvent(r),r._goon);)i=i.parentView;else if(this.triggerEvent(r),r._goon&&this.typeOf("viewgroup"))for(var i=0;i<this.children.length;i++)this.children[i].dispatchEvent(t,e,!1)},dispatchSuroundEvent:function(t,e){var n=new L(this,t,e);if(this.parentView)for(var r in this.parentView.children){var i=this.parentView.children[r];if(i.triggerEvent(n),!n._goon)break}},addEventListener:function(t,e){return this._handlers[t]=e,this},removeEventListener:function(t,e){return this._handlers[t]=null,this["event_"+t]&&(this["event_"+t]=null),this},removeAllEventListener:function(){for(var t in this._handlers)this._handlers[t]=null;for(var t in this)0===t.indexOf("event_")&&(this[t]=null);return this},remove:function(){this.dom.remove()},render:function(){var e=this,n=t.promise();n.scope(this);try{e.onbeforerender&&e.onbeforerender()}catch(r){console.error("[topolr] onbeforerender called error with module of "+e.type()+" Message:"+r.stack)}try{var i=Array.prototype.slice.call(arguments);if(e.autodom)e.autodomc=e.dom.autodom(e.template,e.marcos,["data"],i),$.delegate(e);else{var o=t.template(e.template,e.marcos,["data"]);i.unshift(e.dom),o.renderTo.apply(o,i),$.delegate(e)}}catch(r){console.error("[topolr] render called error with module of "+e.type()+" Message:"+r.stack)}try{e.onendrender&&e.onendrender()}catch(r){console.error("[topolr] onendrender called error with module of "+e.type()+" Message:"+r.stack)}return e._rendered=!0,setTimeout(function(){n.resolve()},0),n},update:function(){this._rendered===!0?this.autodom&&this.autodomc&&this.autodomc.update(Array.prototype.slice.call(arguments)):this.render.apply(this,Array.prototype.slice.call(arguments)),$.delegate(this)},original:function(e){var n=Object.getPrototypeOf(this)[e];if(t.is.isFunction(n)){var r=Array.prototype.slice.call(arguments);return r.splice(0,1),n.apply(this,r)}return n},parentsInvoke:function(e){for(var n=this.parentView,r=null;n;){var i=n[e];if(i&&t.is.isFunction(i)){var o=Array.prototype.slice.call(arguments);o.splice(0,1),r=i.apply(n,o);break}n=n.parentView}return r},parentsParameter:function(t){for(var e=this.parentView,n=null;e&&(n=e.parameters[t],void 0===n);)e=e.parentView;return n},parentViews:function(e){e=t.is.isAvalid(e)?t.is.isNumber(e)?e:parseInt(e):0;for(var n=this.parentView,r=e-1;n&&r>0;)r--,n=n.parentView;return n},previousSibling:function(){if(this.parentView){var t=this.parentView.children.indexOf(this);return 0!==t?this.parentView.children[t-1]:null}return null},nextSibling:function(){if(this.parentView){var t=this.parentView.children.indexOf(this);return t+1<this.parentView.children.length?this.parentView.children[t+1]:null}return null},clean:function(){try{this.onunload()}catch(t){console.error("[topolr] onunload called error with module of "+this.type()+" Message:"+t.stack)}this._finders.length=0,this._groups.length=0;var e=this.parentView;if(e&&e.children){var n=e.children.indexOf(this);if(-1!==n){e.children.splice(n,1);try{e.onchildremove&&e.onchildremove(this)}catch(t){console.error("[topolr] onchildremove called error with module of "+e.type()+" Message:"+t.stack)}}}D.clean(this);var r=Object.keys(this);for(var i in r)this[r[i]]=null},finders:function(e){for(var n=t(),r=0;r<this._finders._data.length;r++)1===arguments.length?this._finders._data[r].data("-finder-")&&this._finders._data[r].data("-finder-").name===e&&n.add(this._finders._data[r]):n.add(this._finders._data[r]);return n},binders:function(e){for(var n=t(),r=0;r<this._binders._data.length;r++)if(1===arguments.length){var i=!1;for(var o in this._binders._data[r].data("-eventback-"))this._binders._data[r].data("-eventback-")[o]===e&&(i=!0);i&&n.add(this._binders._data[r])}else n.add(this._binders._data[r]);return n},groups:function(e){for(var n=t(),r=0;r<this._groups._data.length;r++)1===arguments.length?this._groups._data[r].data("-group-")&&this._groups._data[r].data("-group-").name===e&&n.add(this._groups._data[r]):n.add(this._groups._data[r]);return n},service_schange:function(t,e){this.update(t)},getService:function(t){var e=this.services[t],n=this;return e?{trigger:function(t,r){return e._trigger(t,{data:r,target:n})},action:function(){var t=Array.prototype.slice.call(arguments),n=t.shift();return e["action_"+n]?e["action_"+n].apply(e,t):null},isRunning:function(){return e._isrunning}}:null},isRemoved:function(){return null===this.dom}}),M.add({name:"viewgroup",extend:"view",layout:null,ondomready:null,oninitchild:null,oninitchildend:null,_render:function(e){if(!this.dom.data("--view--")){if(this._rendered=!1,M.isPacketName(this.layout)){var n=this.layout.split("."),r=n.pop(),i=n.join(".");this.layout=E.packetsmapping[this.packet()].getTemplate(i,r)}this.dom.data("--view--",this),this._finders=new $,this._groups=new $,this._binders=new $,this._handlers={},this.children=[];var o=this,s=this.dom.dataset("option"),a=t.queue();if(this.dom.hasClass("_futuretochange_")){this.dom.removeClass("_futuretochange_");var l=M.factory._mapping[this.type()].prototype,u=l.fullClassName;if(this.dom.get(0).tagName.toLowerCase()!==this.tagName){var n=t("<"+l.tagName+" class='"+u+"' data-view='"+this.dom.dataset("view")+"' data-parent-view='"+this.dom.dataset("parentView")+"' data-view-id='"+this.dom.dataset("viewId")+"' daa-option='"+this.dom.dataset("option")+"'></"+l.tagName+">");this.dom.get(0).parentNode.replaceChild(n.get(0),this.dom.get(0)),this.dom=n}}try{I.get(s,function(n){if(o.option||(o.option={}),o.option.override||(o.option.override={}),n){for(var r in n)0===r.indexOf("override_")&&"override"!==r?o.option.override[r.substring(9)]=n[r]:o.option[r]=n[r];for(var r in n.override)o.option.override[r]=n.override[r]}for(var r in o.option.override)M.regs.a.test(r)||(o[r]=o.option.override[r]);if("function"==typeof o.onbeforeinit)try{o.onbeforeinit(o.option)}catch(i){console.error("[topolr] onbeforeinit called error with module of "+o.type()+" Message:"+i.stack)}D.init(o);var s=o.layout;if(!s&&o.dom.children().length>0&&(s=o.dom.html()),t.is.isString(s))try{var l=t.extend({module:function(t,e){var n=t.type,r=t.option,i=t.id,s={tagName:"div",fullClassName:"_futuretochange_"};if(M.factory._mapping[n])var s=M.factory._mapping[n].prototype;return"<"+s.tagName+" class='"+s.fullClassName+"' data-parent-view='"+o.getId()+"' data-view='"+n+"' data-view-id='"+(void 0!==i&&null!==i?i:o.getId()+"-"+o.children.length)+"' data-option='"+(r||"")+"'></"+s.tagName+">"}},o.marcos),u=t.template(s,l,["data","pid","option"],o.autodom);o.autodom?o.autodomc=o.dom.autodom(u,l,["data","pid","option"],[o.option,o.getId(),o.option]):u.renderTo(o.dom,o.option,o.getId(),o.option)}catch(i){console.error("[topolr] parse layout called error with module of "+o.type()+" Message:"+i.stack),o.dom.html("")}if("function"==typeof o.ondomready)try{o.ondomready(o.option)}catch(i){console.error("[topolr] ondomready called error with module of "+o.type()+" Message:"+i.stack)}if("function"==typeof o.onnodeinserted)try{o.onnodeinserted(o.dom)}catch(i){console.error("[topolr] onnodeinserted called error with module of "+o.type()+" Message:"+i.stack)}o._rendered=!0,a.complete(function(t){if(t.name=t.type(),t.shortname=t.shortName(),$.delegate(t),t.className&&""!==t.className&&t.dom.addClass(t.className),"function"==typeof t.init)try{t.init(t.option)}catch(n){console.error("[topolr] init called error with module of "+o.type()+" Message:"+n.stack)}if("function"==typeof t.onendinit)try{t.onendinit(t.option)}catch(n){console.error("[topolr] onendinit called error with module of "+o.type()+" Message:"+n.stack)}e&&e()}),o.dom.find("*[data-parent-view='"+o.getId()+"']").each(function(){a.add(function(e,n){var r=this,i={},s=n.dataset("view"),a=n.dataset("viewId");M.get(s,null,function(s){for(var l=s.__info__.types.length-1;l>=0;l--)t.extend(i,e.option[s.__info__.types[l]]);if(t.extend(i,e.option[a]),t.extend(s.option,i),n.data("--view--"))r.next(e);else{var u=s;if(u.dom=n,u.parentView=e,e.oninitchild)try{e.oninitchild(u)}catch(h){console.error("[topolr] oninitchild called error with module of "+o.type()+" Message:"+h.stack)}e.children.push(u),u.privator("render",function(){if(e.oninitchildend)try{e.oninitchildend(u)}catch(t){console.error("[topolr] oninitchildend called error with module of "+o.type()+" Message:"+t.stack)}r.next(e)})}})},function(t,e){console.error(e),this.next(o)},t(this))}),a.run(o)})}catch(h){e&&e(),console.error(h.stack)}}return this},_addChild:function(e,r){var i=this,o=t.extend({type:null,option:"",parameters:null,localService:null,id:this.getId()+"-"+this.children.length,container:"body",domIndex:null,target:null,index:null},e),s=o.index;o.container.isWrapper&&!o.container.isWrapper()&&(o.container="body");try{M.get(o.type,null,function(e){void 0===s||null===s||s>=i.children.length?i.children.push(e):i.children.splice(s,0,e);var a=M.factory._mapping[e.type()].prototype.fullClassName,l=t(o.container),u=t("<"+e.tagName+" class='"+a+"' data-parent-view='"+i.getId()+"' data-view='"+o.type+"' data-view-id='"+o.id+"' data-option='"+(n.isObject(o.option)?"":o.option)+"'></"+e.tagName+">");if(n.isNumber(o.domIndex)){var h=l.children(o.domIndex);h.length>0?e.dom=u.insertBefore(h):e.dom=u.appendTo(l,!1)}else e.dom=u.appendTo(l,!1);for(var c={},p=e.__info__.types.length-1;p>=0;p--)t.extend(c,i.option[e.__info__.types[p]]);if(t.extend(c,t.json.clone(e.option)),t.extend(c,i.option[o.id]),t.extend(c,i.option[o.type]),n.isObject(o.option)){var d={};d.override=o.option.override||{};for(var p in o.option)"override"!==p&&(0===p.indexOf("override_")?d.override[p.substring(9)]=o.option[p]:d[p]=o.option[p]);e.option=t.extend(c,d);for(var p in e.option.override)M.regs.a.test(p)||(e[p]=e.option.override[p])}if(i.dom.contain(e.dom)||(e.___outer___=!0),i.oninitchild)try{i.oninitchild(e)}catch(f){console.error("[topolr] oninitchild called error with module of "+i.type()+" ["+f.stack+"]")}e.option=c,e.parameters=o.parameters,e.target=o.target,e.parentView=i,o.localService&&D.setLocalService(e,o.localService),e.privator("render",function(){if("function"==typeof i.oninitchildend)try{i.oninitchildend(e)}catch(t){console.error("[topolr] oninitchildend called error with module of "+i.type()+" ["+t.stack+"]")}r&&r.call(e)})})}catch(a){r&&r.call(null),console.error(a.stack)}},render:function(){},reRender:function(){var e=t.promise();return e.scope(this),this.dom.unbind(),this.dom.get(0).datasets={},this.privator("render",function(){e.resolve()}),e},update:function(t){this.autodom&&this.autodomc&&this.autodomc.update([t||this.option,this.getId(),this.option]),$.delegate(this)},getChildrenByType:function(t){for(var e=[],n=0;n<this.children.length;n++)this.children[n].typeOf(t)&&e.push(this.children[n]);return e},getChildByType:function(t,e){return e=void 0===e||e===e?0:e,
this.getChildrenByType(t)[e]},getChildById:function(t){for(var e=null,n=0;n<this.children.length;n++)if(this.children[n].getId()===t){e=this.children[n];break}return e},getChildAt:function(e){return t.is.isNumber(e)&&e>=0&&e<this.children.length?this.children[e]:null},childEach:function(t){for(var e=0;e<this.children.length&&t&&t.call(this.children[e],this.children[e],e,this.children)!==!1;e++);},contains:function(t){return-1!==this.children.indexOf(t)},getFirstChild:function(e){return t.is.isAvalid(e)?this.getChildrenByType(e)[0]:this.children[0]},getLastChild:function(e){var n=null;if(t.is.isAvalid(e)){var r=this.getChildrenByType(e);r.length>0&&(n=r[r.length-1])}else this.children.length>0&&(n=this.children[this.children.length-1]);return n},getChildIndex:function(t){return this.children.indexOf(t)},addChild:function(t){var e=this,n=new h;return n.scope(this),M.task.add(function(t,r){var i=this;e.privator("addChild",r,function(){i.next(),n.resolve(this)})},null,t),n},setChildIndex:function(t,e){if(void 0!==e&&null!==e&&e<this.children.length-1){var n=this.children.indexOf(t);this.children.splice(n,1),this.children.splice(e,0,t)}return this},duplicateChild:function(e,n){return e&&this.privator("addChild",null,{type:this.name,option:t.extend({},this.option),parameters:this.parameters,id:n||this.getId()+"-"+this.children.length,container:this.dom.parent()}),this},removeChild:function(t){var e=this.getChildById(t);return e&&e.remove(),this},removeChildAt:function(e){return t.is.isNumber(e)&&e>0&&e<this.children.length&&this.children[e].remove(),this},removeAllChild:function(){for(;this.children.length>0;)this.children.pop().remove();return this},clean:function(){var t=[];for(var e in this.children)this.children[e].___outer___&&t.push(this.children[e]);for(;t.length>0;)t.pop().remove();try{this.onunload()}catch(n){console.error("[topolr] onunload called error with module of "+this.type()+" Message:"+n.stack)}var r=this.parentView;if(r&&r.children){var i=r.children.indexOf(this);if(-1!==i){r.children.splice(i,1);try{r.onchildremove&&r.onchildremove(this)}catch(n){console.error("[topolr] onchildremove called error with module of "+r.type()+" Message:"+n.stack)}}}D.clean(this),D.cleanLocalInstance(this);var o=Object.keys(this);for(var e in o)this[o[e]]=null},createLocalService:function(t,e){return D.getLocalInstance(t,e,this)},setLocalService:function(t,e){D.setLocalService(t,e)}}),M.add({name:"root",extend:"viewgroup",className:"root",init:function(){M.isMutation()?this.dom.mutationObserve(function(t){for(var e=0;e<t.length;e++){for(var n=t[e],r=n.addedNodes,i=n.removedNodes,o=0;o<r.length;o++)M.domInserted(r[o].parentNode,r[o]);for(var o=0;o<i.length;o++)M.domRemoved(n.target,i[o])}},{childList:!0,subtree:!0}):this.dom.bind("DOMNodeInserted",function(t){M.domInserted(t.target.parentNode,t.target)}).bind("DOMNodeRemoved",function(t){M.domRemoved(t.path[1],t.target)}),console.log("[topolr] root view init.")}}),k.option.debug&&(window["topolr-source"]=N,window["topolr-packet"]=E,window["topolr-module"]=M,window["topolr-app"]=k);var R={};t.overrideModule=function(t,e){var n=M.factory.get(t);if(n)for(var r in e)"init"!==r&&"option"!==r&&"extend"!==r&&(n.prototype[r]=e[r])},t.Option=function(e){if(n.isString(e)){var r=I.has(e);return r?i.clone(r):null}var o=e.option,s=[];e.extend&&(n.isString(e.extend)?s.push(e.extend):s=e.extend);for(var a=0;a<s.length;a++){var r=I.has(s[a]);if(!r)throw Error("[topolr ] can not find option with name of "+s[a]);t.extend(o,i.clone(r))}for(var a in e.override)for(var l=a.split("."),u=o,h=0;h<=l.length-1;h++){var c=l[h],p=u[c];n.isObject(p)||(u[c]={}),h===l.length-1?u[c]=e.override[a]:u=u[c]}I.add(e)},t.Module=function(t){M.add(t)},t.override=function(e,r){n.isString(e)&&n.isObject(r)&&(R[e]?t.extend(R[e],r):R[e]=t.extend(new f,r))},t.toggle=function(t){n.isString(t)?R[t]&&(c.prototype=R[t]):c.prototype=new f},t.global={},t.fn=f.prototype,window.topolr=t,window.App=t.app,window.$=t}();